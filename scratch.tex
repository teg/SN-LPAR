% Preempt some bad decisions by LLNCS
\RequirePackage{fixllncs}


\documentclass[orivec]{llncs}


% To get cases in equations
\usepackage{amsmath}

% To use definitions, lemmas and theorems.
%\usepackage{amsthm}

% twoheadleftarrow
\usepackage{amssymb}

% Nicer array and tabular layout (IEEE-suggested)
\usepackage{array}

% A more pleasant font
\usepackage[T1]{fontenc} % use postscript type 1 fonts
\usepackage{textcomp} % use symbols in TS1 encoding
%\usepackage[garamond]{mathdesign} % use a nice font

% A taste of french
%\usepackage[french]{babel}
\usepackage[utf8]{inputenc}

% Allow inclusion of graphics
%\usepackage[pdftex]{graphicx}

% To get url's
%\usepackage[hidelinks]{hyperref}

% Improves the text layout
\usepackage{microtype}

% For in-line lists
\usepackage{paralist}

% To typeset derivations
\usepackage[lutzsyntax,pdftex]{virginialake}

% Landscape-orientated floats
\usepackage{rotating}

% To get semantic brackets
\usepackage{stmaryrd}

% Don't remember what this does
\usepackage[normalem]{ulem}

\usepackage{proof}

% Nice fractions
\usepackage{units}

% For commands with multiple optional arguments
\usepackage{xargs}

% Our own stuff
\usepackage{ALmacros}
%\usepackage{includeFigure}
%\input{ALpictures}
\usepackage{willemtools}

% Get counters and fonts right for theorem environments
\spnewtheorem{ALtheorem}{Theorem}{\bfseries}{\itshape}
\spnewtheorem{ALdefinition}[ALtheorem]{Definition}{\bfseries}{\upshape}
\spnewtheorem{ALproposition}[ALtheorem]{Proposition}{\bfseries}{\itshape}
\spnewtheorem{ALlemma}[ALtheorem]{Lemma}{\bfseries}{\itshape}


\newif\ifnonotes\nonotesfalse
\newcommand{\EMPTY}[1]{\ifnonotes\else{\color{red}    \noindent #1}\fi}
\newcommand{\Comment}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Comment: }#1}\fi}
\newcommand{\Remark}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Remark: }#1}\fi}
\newcommand{\TODO}[1]{\ifnonotes\else{\color{red}    \noindent{\bf TODO }#1}\fi}
%\newcommand{\Rem}[1]{\ifnonotes\else{\color{red}    \bigskip\\{\bf Remark: }#1 \bigskip\\}\fi}
%\nonotestrue % If this is commented, notes appear in the paper (if any)
%---------------------------------------------------------- REMOVE WHEN FINISHED



\begin{document}

\begin{ALlemma}[Draft]
Subject reduction for the distributor rule of $D_a$.
\end{ALlemma}

\begin{proof}

\noindent
Distributor introduction, before:
\[
\vlderivation{
  \vliiin{}{}
	{\vdash u\share x{\lambda y.t}:C}
	{\vlhy{(x_i:\bigcap_{j\leq m}(A_j\vlim B_j))_{i\leq n}\vdash u:C}}
	{\vlhy{}}
	{\vlin{}{}
	  {\vdash\lambda y.t:\bigcap_{j\leq m}(A_j\vlim B_j)}
	  {\vlhy{
	    \left(
		\vlinf{}{}
	 	  {\vdash\lambda y.t:A_j\vlim B_j}
		  {y:A_j\vdash t:B_j}
		\right)_{j\leq m}
	}}}
}
\]

\noindent
Distributor introduction, after:
\[
  \vliiinf{}{}
	{u\distr xy{\tup z\share zt}:C}
	{\raisebox{-25pt}{
		$(x_i:\bigcap_{j\leq m}(A_j\vlim B_j))_{i\leq n}\vdash u:C$
	}}	
	{\vlhy{}}
	{\left(\vlderivation{
		\vliiin{}{}
	 	  {y:A_j\vdash \tup z\share zt : B_j\vlan\dotso\vlan B_j}
		  {\vlhy{y:A_j\vdash t:B_j}}
		  {\vlhy{}}
		  {\vlin{}{}
			{(z_i:B_j)_{i\leq n}\vdash \tup z:B_j\vlan\dotso\vlan B_j}
			{\vlhy{
				\Big(
					\raisebox{5pt}{$\vlinf{}{}{z_i:B_j\vdash z_i:B_j}{}$}
				\Big)_{i\leq n}}}
		}}
		\right)_{j\leq m}
	}
\]


\noindent
Distributor elimination, $y$ not weakened, before:
\[
\vliiinf{}{}
  {u\distr xy{\tup t\share*{\vv*z}y}:C}
  {\raisebox{-25pt}{$(x_i:\bigcap_{j\leq m}(A_j\vlim B^i_j))_{i\leq n}\vdash u:C$}}
  {}
  {\left(
	\vlderivation{
	  \vliiin{}{}
		{y:A_j\vdash \tup t\share*{\vv*z}y:B^1_j\vlan\dotso\vlan B^n_j}
		{\vlin{}{}
		  {\vv*z:A_j\vdash\tup t:B^1_j\vlan\dotso\vlan B^n_j}
		  {\vlhy{(\vv*z_i:A_j\vdash t_i:B^i_j)_{i\leq n}}}
		}
		{\vlhy{}}
		{\vlin{}{}{y:A_j\vdash y:A_j}{}}
	}
   \right)_{j\leq m}
  }
\]

\noindent
Distributor elimination, $y$ not weakened, after: for each $i\leq n$:
\[
\vlinf{}{}
  {\vdash\lambda y_i.t_i\share*{\vv*z_i}{y_i}:\bigcap_{j\leq m}(A_j\vlim B^i_j)}
  {\left(
	\vlderivation{
	  \vlin{}{}
		{\vdash\lambda y_i.t_i\share*{\vv*z_i}{y_i}:A_j\vlim B^i_j}
		{\vliiin{}{}
		  {y:A_j\vdash t_i\share*{\vv*z_i}{y_i}\:B^i_j}
		  {\vlhy{\vv*z_i:A_j\vdash t_i:B^i_j}}
		  {\vlhy{}}
		  {\vlin{}{}{y:A_j\vdash y:A_j}{}}
	}}
   \right)_{j\leq m}
  }
\]

\noindent
Distributor elimination, $y$ weakened, before:
\[
\vliiinf{}{}
  {u\distr xy{\tup t\share*{}y}:C}
  {\raisebox{-16pt}{$(x_i:\bigcap_{j\leq m}(A_j\vlim B^i_j))_{i\leq n}\vdash u:C$}}
  {}
  {\left(
	\vlderivation{
	  \vliiin{}{}
		{y:V_j\vdash \tup t\share*{}y:B^1_j\vlan\dotso\vlan B^n_j}
		{\vlin{}{}
		  {\vdash\tup t:B^1_j\vlan\dotso\vlan B^n_j}
		  {\vlhy{(\vdash t_i:B^i_j)_{i\leq n}}}
		}
		{\vlhy{}}
		{\vlin{}{}{y:V_j\vdash y:V_j}{}}
	}
   \right)_{j\leq m}
  }
\]

\noindent
Distributor elimination, $y$ weakened, after: for each $i\leq n$:
\[
\vlinf{}{}
  {\vdash\lambda y_i.t_i\share*{}{y_i}:\bigcap_{j\leq m}(A_j\vlim B^i_j)}
  {\left(
	\vlderivation{
	  \vlin{}{}
		{\vdash\lambda y_i.t_i\share*{}{y_i}:A_j\vlim B^i_j}
		{\vliiin{}{}
		  {y:A_j\vdash t_i\share*{}{y_i}\:B^i_j}
		  {\vlhy{\vdash t_i:B^i_j}}
		  {\vlhy{}}
		  {\vlin{}{}{y:A_j\vdash y:A_j}{}}
	}}
   \right)_{j\leq m}
  }
\]

\noindent
During reduction, in the typing derivations for $t^n$ in
\[
\vliiinf{}{}
	{u\distr xy{t^n}:C}
	{(x_i:\bigcap_{j\leq m}(A_j\vlim B^i_j))_{i\leq n}\vdash u:C}	
	{\vlhy{}}
	{(y:V_j\vdash t^n:B^1_j\vlan\dotso\vlan B^n_j)_{j\leq m}}
\]
the following holds for the variable $y$:
\begin{itemize}

	\item
if it is weakened, it remains weakened;

	\item
if it is not, it may become weakened only through a beta-step in $t^n$;

	\item
if it becomes weakened, it may retain its previous type.

\end{itemize}

\end{proof}




\end{document}


\begin{ALlemma}
\label{lem:weakening SN}
If $(t)\overline w\in\SN$, then $\forall v\in\SN.~(t\share*{}v)\overline w\in\SN$.
\end{ALlemma}

\begin{ALlemma}
\label{lem:weakening RED}
If $(t)\overline w\in|B|$, then $\forall v\in\SN.~(t\share*{}v)\overline w\in|B|$.
\end{ALlemma}

\begin{proof}
The proof is by induction on $B$.
%
The case where $B$ is an atom is covered by Lemma~\ref{lem:weakening SN}; the case $B=C\cap D$ is immediate.
%
For $B=C\vlim D$, let $v\in\SN$. 
%
We have to show that $(t\share*{}v)\overline w\in|C\vlim D|$, i.e.\ that $(t\share*{}v)\overline ww\in |D|$ for all $w\in|C|$.
%
Let $w\in|C|$.
%
Because $(t)\overline w\in|C\vlim D|$, we have $(t)\overline ww\in|D|$, and by the induction hypothesis, $(t\share*{}v)\overline ww\in|D|$.
\end{proof}


\begin{ALlemma}
\label{lem:unfolding weakened variable}
If a variable $y$ occurs free and weakened in a term $t$ then the unfolding of $t$ is of the form $t'\share*{}y$.
\end{ALlemma}



\noindent{\color{red} To be inserted into the proof of `Proposition 23'}

\noindent{\color{red} Part (i)}

We distinguish two cases, depending on whether $y$ occurs weakened.

\medskip

\textbf{(i)} The variable $y$ occurs weakened.
%
In this case, $V_j=A_j$.

\noindent{\color{red} Part (ii)}

\medskip

\textbf{(ii)} The variable $y$ occurs weakened.
%
By the induction hypothesis, 
\[
	u'=u^n\subn[m][j]{z_j}{w_j}\in|B_j\vlan\dotso\vlan B_j|
\]
for each $j\leq m$, and therefore $\pi_i(u')\in|B_j|$, and $\sn(\pi_i(u'))\in|B_j|$.
%
Because $y$ is weakened, we have $\sn(\lambda y.\pi_i(u'))=\lambda y.u''\share*{}y$ with $u''=\sn(\pi_i(u'))$.
%
Since $u''\in|B_j|$, by Lemma~\ref{lem:weakening RED} we have $u''\share*{}v\in|B_j|$ for any $v\in\SN$.
%
Therefore $\lambda y.u''\share*{}y\in|V\vlim B_j|$ for any formula $V$, and in particular $\lambda y.u''\share*{}y\in|A_j\to B_j|$.
%
This means that $\sn(\lambda y.\pi_i(u'))$ is in $|\bigcap_{j\leq n}(A_j\vlim B_j)|$, as is any variant of it.
%
By the induction hypothesis, 
\[
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}\in|C|
\]
and by Lemma~\ref{lem:Red-AddSharings}
\[
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}[\sh(\lambda y.u^n)]\in|C|\;.
\]
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $s'\distr xy{u'}\in|C|$.


\end{document}








