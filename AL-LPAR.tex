% Preempt some bad decisions by LLNCS
\RequirePackage{fixllncs}


\documentclass[orivec]{llncs}


% To get cases in equations
\usepackage{amsmath}

% To use definitions, lemmas and theorems.
%\usepackage{amsthm}

% twoheadleftarrow
\usepackage{amssymb}

% Nicer array and tabular layout (IEEE-suggested)
\usepackage{array}

% A more pleasant font
\usepackage[T1]{fontenc} % use postscript type 1 fonts
\usepackage{textcomp} % use symbols in TS1 encoding
%\usepackage[garamond]{mathdesign} % use a nice font

% A taste of french
%\usepackage[french]{babel}
\usepackage[utf8]{inputenc}

% Allow inclusion of graphics
%\usepackage[pdftex]{graphicx}

% To get url's
%\usepackage[hidelinks]{hyperref}

% Improves the text layout
\usepackage{microtype}

% For in-line lists
\usepackage{paralist}

% To typeset derivations
\usepackage[lutzsyntax,pdftex]{virginialake}

% Landscape-orientated floats
\usepackage{rotating}

% To get semantic brackets
\usepackage{stmaryrd}

% For fancy underlining and strikethroughs
\usepackage[normalem]{ulem}

% Nice fractions
\usepackage{units}

% For commands with multiple optional arguments
\usepackage{xargs}

% Our own stuff
\usepackage{ALmacros}
%\usepackage{includeFigure}
%\input{ALpictures}
\usepackage{willemtools}

% Get counters and fonts right for theorem environments
\spnewtheorem{ALtheorem}{Theorem}{\bfseries}{\itshape}
\spnewtheorem{ALdefinition}[ALtheorem]{Definition}{\bfseries}{\upshape}
\spnewtheorem{ALproposition}[ALtheorem]{Proposition}{\bfseries}{\itshape}
\spnewtheorem{ALlemma}[ALtheorem]{Lemma}{\bfseries}{\itshape}


\newif\ifnonotes\nonotesfalse
\newcommand{\EMPTY}[1]{\ifnonotes\else{\color{red}    \noindent #1}\fi}
\newcommand{\Comment}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Comment: }#1}\fi}
\newcommand{\Remark}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Remark: }#1}\fi}
\newcommand{\TODO}[1]{\ifnonotes\else{\color{red}    \noindent{\bf TODO }#1}\fi}
%\newcommand{\Rem}[1]{\ifnonotes\else{\color{red}    \bigskip\\{\bf Remark: }#1 \bigskip\\}\fi}
%\nonotestrue % If this is commented, notes appear in the paper (if any)
%---------------------------------------------------------- REMOVE WHEN FINISHED



% TO DO

% p.6, proposition 12: you have not yet defined the set V. Also, I guess you must suppose that A is not a conjunctive formula.

% p. 8, second paragraph after Lemma 19: "is defined as the length of $t\G$". Which $t$? I did not understand this sentence.

% Lemma 16 is proved from Lemma 20. You should avoid this backward quotation, which may produce loops.



%-------------------------- FRONTMATTER

\title{A Proof of Strong Normalisation of the Typed Atomic Lambda-Calculus}

\author{Tom Gundersen\inst{1} \and
Willem Heijltjes\inst{2} \and
Michel Parigot\inst{1}}

\authorrunning{Gundersen, Heijltjes, \& Parigot}

\institute{Laboratoire Preuves, Programmes, SystÃ¨mes \\ CNRS \& Universit\'e Paris Diderot \\ {\tt teg@jklm.no, parigot@pps.univ-paris-diderot.fr}
\and University of Bath \\ {\tt w.b.heijltjes@bath.ac.uk} }


% ==============================================================================================================================================================================


\begin{document}


\maketitle

\begin{abstract}
The atomic lambda-calculus is a typed lambda-calculus with explicit sharing, which originates in a Curry-Howard interpretation of a deep-inference system for intuitionistic logic.
%
It has been shown that it allows fully lazy sharing to be reproduced in a typed setting.
%
In this paper we prove strong normalization of the typed atomic lambda-calculus using Tait's reducibility method.
%
%In addition we give a characterisation of exactly the strongly normalisable atomic lambda-terms by an intersection typing discipline.
%
%A characterisation of exactly the strongly normalisable terms by an intersection typing discipline, which proves to be extremely subtle, is outlined.
\end{abstract}


% citations to preserve:
%	\cite{Mellies-1995}

%
%One should say (in a better way that what follows) that:
% we prove two fundamental results:
%- we prove that typed atomic terms are strongly normalizing, using Tait's reducibility method;
%- strongly normalizing pure atomic terms can be characterized  using a type system with intersection;
%These results together shows that atomic lambda-calculus is  a rich mathematical object allowing to study lambda-calculus with sharing in the same way as lambda-calculus.
%(I guess, you see what I want to say ...)






% =================================================================================================
\section{Introduction}



The \emph{atomic lambda-calculus} is a typeable lambda-calculus with explicit sharing, recently introduced in \cite{Gundersen-Heijltjes-Parigot-2013-JFLA,Gundersen-Heijltjes-Parigot-2013-LICS}, developed as the Curry--Howard interpretation of a deep-inference proof system for intuitionistic logic.
%
The present paper constitutes an important step in the development of its meta-theory, by extending Tait's reducibility method to show strong normalisation of the simply typed atomic lambda-calculus.
%
The primary motivation for establishing this result is to demonstrate that the atomic lambda-calculus is a natural and well-behaved calculus, to which the main standard techniques and results apply.



\emph{Sharing} is an approach to efficient computation in lambda-calculi whereby duplication of subterms is deferred in favor of reference to a common representation.
%
It is a leading principle behind, among others, explicit substitution calculi \cite{Abadi-Cardelli-Curien-Levy-1991,Lescanne-1994,David-Guillaume-2001,DiCosmo-Kesner-Polonovski-2003,Kesner-Lengrand-2007,Accattoli-Kesner-2010}, term calculi with strategies or higher-order transformations \cite{Hughes-1982,Ariola-Felleisen-Maraist-Odersky-Wadler-1995}, and sharing graphs in the style of Lamping \cite{Lamping-1990,Asperti-Guerrini-1998,VanOostrom-VanDeLooij-Zwitserlood-2004}.
%
The atomic lambda-calculus represents a novel category in this range.
%
As a typeable term calculus it is an alternative to explicit substitution calculi, providing a different perspective on sharing: as in sharing graphs, sharing is evaluated \emph{atomically}, by duplicating individual constructors.
%
A salient property is that the calculus implements \emph{fully lazy sharing} \cite{Wadsworth-1971,Hughes-1982,Balabonski-2012}, a degree of sharing that, while standard, had previously been achieved in lambda-calculi only by means of external transformations.



The paper \cite{Gundersen-Heijltjes-Parigot-2013-LICS} details how the atomic lambda-calculus and its sharing mechanisms are derived from \emph{deep inference} \cite{Brunnler-Tiu-2001}, a proof methodology where inferences apply \emph{in context}, reminiscent of term rewriting.
%
Sharing in deep inference is by explicit \emph{contraction} rules, which implement atomic duplication by interacting with individual inferences.
%
By embedding natural deduction within the deep-inference formalism \emph{open deduction} \cite{Guglielmi-Gundersen-Parigot-2010}, duplication in traditional normalisation is broken up into atomic steps.
%
The atomic lambda-calculus is a direct computational interpretation of the resulting proof system.
%
The paper \cite{Gundersen-Heijltjes-Parigot-2013-LICS} further establishes the technical properties of full laziness and \emph{PSN}, preservation of strong normalisation with respect to the lambda-calculus.



In the present paper strong normalisation for the typed atomic lambda-calculus will be proven using the Tait-reducibility method \cite{Tait-1967,ProofsAndTypes}.
%
Reducibility is an abstract method compatible with higher-order logic, whose application provides a deeper understanding of reduction and its dynamics.
%
%\emph{Intersection types} \cite{Coppo-DezaniCiancaglini-1980,Pottinger-1980,Krivine-1993} further allow the characterisation of exactly the strongly normalisable terms.
%
%Together, the two form an important part of the meta-theory of a calculus (for example for explicit substitution calculi, in \cite{Dougherty-Lescanne-2001,Ghilezan-Ivetic-Lescanne-Likavec-2011}).
%
The fact that a reducibility proof can be carried out for the atomic lambda-calculus shows the generic character of this extension
of the lambda-calculus.
%
Nevertheless, the proof is not a straightforward generalisation of the one for lambda-calculus, because one has to overcome
the lack of local confluence.
%
%I would like to add something like this to avoid that the referee says: it is only a technical
%generalization; you need only perseverance to get it; etc.
%
%For compactness the proof will be carried out for a discipline of simple types, and will be shown extensible to intersection types.



%The characterisation of exactly the strongly normalisable atomic lambda-terms by intersection types is more subtle than for the lambda-calculus, due to the fact that garbage collection is an integral part of the computation.
%
%Such a type system is given in Section~\ref{sec:SND}, and the proof of the characterization is outlined.

%The interaction of atomic duplication rules with beta-reduction means that a certain, natural amount of garbage collection is required inbetween beta-reduction steps.
%
%As a consequence, terms are strongly normalisable that don't appear so.
%
%A characterisation to capture these terms is outlined in the last section of the paper.


% =================================================================================================
\section{The atomic lambda-calculus}
\label{sec:atomic-lambda-calculus}



The \emph{atomic lambda-calculus} introduced in \cite{Gundersen-Heijltjes-Parigot-2013-LICS} is a refined lambda-calculus, in which abstraction is split into a linear abstraction and a sharing operation.
%
Duplication and deletion proceeds locally through the evaluation of sharings.
%
The calculus consists of a standard linear lambda-calculus with a sharing construct, extended by a further construction called the \emph{distributor}.
%
The distributor allows to duplicate an abstraction without duplicating its scope: it replaces the abstraction while duplication of its scope is in progress, where the duplicated parts of the scope are stored in a tuple of terms (see also the reduction rules in Section~\ref{ssec:reduction rules}).



\begin{ALdefinition}
%
The \emph{atomic lambda-calculus} $\Lambda_A$ is defined by the grammars
%
\setMidspace{10pt}
\[
\begin{array}{r@{\Coloneq}c@{\Mid}l}
	s,t,u,v,w
	&	x \Mid \lambda x.t
	&	(t)u \Mid t\g
\\[5pt]
	\g,\g*  &  \share xt  &  \distr xy{t^n}
\\[5pt]
	t^n  &  \tup t  &  t^n\g
\end{array}
\]
where
%
\begin{inparaenum}[(i)]
\item $n\geq0$, 
%
\item each variable may occur at most once in a term,
%
\item in $\lambda x.t$, $x$ must be free in $t$ and becomes bound,
%
\item in $\lambda y.t^n$, $y$ must be free in $t^n$ and becomes bound, %and
%
\item in $t\g$ where $\g$ is $\share xu$ or $\distr xy{t^n}$, each $x_i$ must be free in $t$ and becomes bound, and 
%
\item likewise for $t^n\g$.
%
\end{inparaenum}
%
\end{ALdefinition}



Terms $t$ are \emph{atomic lambda-terms}.
%
The \emph{closures} $\g$ are called respectively \emph{sharing} and \emph{distributor}, and a nullary sharing $\share*{}t$ is a \emph{weakening}.
%
Atomic lambda-terms not containing a distributor are \emph{basic} terms.
%
A sequence of closures $\g[1]\ldots\g[n]$ will be denoted $\g[i]_{i\leq n}$ or $\G$.
%
The $t^n$ are \emph{terms of multiplicity $n$} or \emph{$n$-terms}, and are of the form $\tup t\G$.
%
Where possible, terms and $n$-terms will not be distinguished, and both denoted $t,u,v$.
%
A sequence of variables $\vv x$ may be abbreviated $\vv*x$; a sharing is then denoted $\share*{\vv*x}t$.
%
Standard notions are: $\FV(u)$ is the set of free variables of $u$, and $u\sub xt$ denotes the substitution of $t$ for $x$ in $u$.
%
A series of substitutions $\sub{x_1}{t_1}\dotso\sub{x_n}{t_n}$ is abbreviated $\subn{x_i}{t_i}$.



Atomic lambda terms will be considered up to the congruence $(\sim)$ induced by~\eqref{eqn:explicit permutation} below;
note that due to linearity, both terms are only well-defined if both $\g$ and $\g*$ bind only in $t$.
%
\begin{equation}\label{eqn:explicit permutation}
	t\g\g* ~\sim~ t\g*\g
\end{equation}
%
The functions $\tercoden-\,:\,\Lambda\to\Lambda_A$ and $\terden-\,:\,\Lambda_A\to\Lambda$ translate between atomic lambda-terms and standard lambda-terms.
%
The former is defined below.
%
For a formal definition of the function $\tercoden-$ see \cite{Gundersen-Heijltjes-Parigot-2013-LICS}; intuitively, it replaces each abstraction $\lambda x.-$ in a term by $\lambda x.-\share xx$, where $\vv x$ replace the occurrences of $x$, so that $\terden{\tercoden N}=N$ for any lambda-term $N$.


\begin{ALdefinition}
The functions $\den-$ and $\den*-$ interpret atomic lambda-terms and closures respectively as lambda-terms and substitutions.
%
For a sequence of closures $\G=\g\G'$ with $\G'$ non-empty, let $\BR\G=\BR\g\BR{\G'}$. 
%
\[
\begin{array}{r@{{}={}}l}
	\den x = x
\qquad	\den {\lambda x.t} = \lambda x.\den t
\qquad	\den {(t)u} & (\den t)\den u
\qquad	\den {t\g} = \den t\BR\g
	\\[6pt]	\BR{\share xt}				& \subn{x_i}{\den t}
	\\[6pt]	\BR{\distr xy{\tup t\G}}	& \subn{x_i}{\lambda y.\den{t_i}\BR\G}
\end{array}
\]
%
\end{ALdefinition}






% =================================================================================================
\subsection{Reduction rules}
\label{ssec:reduction rules}

Reduction in the atomic lambda-calculus, denoted $\rewrite$, consists of two parts:
\begin{inparaenum}[\upshape(i)]
 \item linear $\beta$-reduction, denoted $\ALbeta$: the usual rule (rule~\ref{eqn:beta-reduction} below) applied linearly;
 \item sharing reductions, denoted $\ALnotbeta$, comprising two kinds of rule: (a) \emph{permutations} taking closures outward (rules~\ref{eqn:sharing above abstraction}--\ref{eqn:sharing above distribution}), and (b) local \emph{transformations} that evaluate closures (rules~\ref{eqn:compound sharings}--\ref{eqn:distributor elimination}).
\end{inparaenum}
%
\bigskip

\noindent
{\bf Linear  $\beta$-reduction:}
%
\begin{equation}\tag{$\beta$}\label{eqn:beta-reduction}
	(\lambda x.u)t ~\ALbeta~ u\sub xt
\end{equation}



\noindent
{\bf Permutations of closures:}
%
\begin{align}\label{eqn:sharing above abstraction}
	\lambda x.t\g & ~\ALnotbeta~ (\lambda x.t)\g
		 & \text{if}~x\in\FV(t) &&&
\\\label{eqn:sharing above application function}
	(u\g)t & ~\ALnotbeta~ ((u)t)\g
\\\label{eqn:sharing above application argument}
	(u)t\g & ~\ALnotbeta~ ((u)t)\g
\\\label{eqn:sharing above sharing}
	u\share x{t\g} & ~\ALnotbeta~ u\share xt\g
\\\label{eqn:sharing above distribution}
	u\distr xy{t^n\g} & ~\ALnotbeta~ u\distr xy{t^n}\g
		& \text{if}~y\in\FV(t^n) &&&
\end{align}



\noindent
{\bf Transformations on closures:}
%
\begin{gather}
\label{eqn:compound sharings}
	u\share*{\vv*y}y\share*{\vv*x,y,\vv*z}t ~\ALnotbeta~
	u\share*{\vv*x,\vv*y,\vv*z}t
\\[5pt]
\label{eqn:share application}
	u\share x{(v)t} ~\ALnotbeta~
	u\subn{x_i}{(y_i)z_i}\share yv\share zt
\\[5pt]
\label{eqn:share abstraction}
	u\share x{\lambda x.t}~\ALnotbeta~ u\distr xx{\tup y\share yt}
\\[5pt]\notag
	u\distr xy{\tup t\share*{\vv*z}{y}}~\ALnotbeta~
	u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}
\\[5pt]
	\rule{4cm}{0pt}\mbox{where } \{\vv*z_i\} = \{\vv*z\}\cap\FV(t_i) \mbox{ for every }i\leq n
\label{eqn:distributor elimination}
\end{gather}


The fact that a term $u$ reduces to $v$ in exactly $n$ steps will be denoted $u \rewrite^n v$, while an arbitrary number of steps is indicated simply by $\rewrite$.
%
A term $u$ is called \emph{strongly normalisable} if all the reduction sequences starting with $u$ are finite.
%
The set of strongly normalisable terms is denoted $\SN$.
%
Reduction in the atomic lambda-calculus commutes 1--1 with substitution, due to the linearity condition on free variables.


\begin{ALlemma}
For atomic lambda-terms $u$, $u'$, $v$ and $v'$ and variable $x \in \FV(u)$,
%
if $u \rewrite^1 u'$, then $u\sub xv \rewrite^1 u'\sub xv$; and
if $v\rewrite^1 v'$, then $u\sub xv \rewrite^1 u\sub x{v'}$.
\end{ALlemma}


% =================================================================================================
\subsection{Basic properties of the atomic lambda-calculus}
\label{ssec:basic properties}

We collect in this section the main basic properties we are using in the strong normalisation proof. The two main properties are (i) the strong normalisation property of the sharing reduction, and (ii) the  decomposition of the computational content of sharings and distributors.

\begin{ALtheorem}[{\cite[Theorem 11]{Gundersen-Heijltjes-Parigot-2013-LICS}}]
The reduction $\ALnotbeta$ is strongly normalising and confluent.
\end{ALtheorem}

\noindent
%
Sharing reductions preserve the denotation $\den t$ of a term \cite[Prop.~10]{Gundersen-Heijltjes-Parigot-2013-LICS}.
%
The normal form under $\ALnotbeta$ of an atomic lambda-term $t$ is called its \emph{unfolding} $\unfold(t)$.
%
It is a basic term (i.e., no distributors occur) of the form $u\G$, where sharing in $u$ occurs only as $\lambda y.v\share*{\vv*x}y$, of bound variables immediately within the scope of their binder, and where $\G$ are sharings $\share*{\vv*x}y$ of the free variables $y$ in $t$ that occur in shared subterms \cite[Prop.~9]{Gundersen-Heijltjes-Parigot-2013-LICS}.
%
For closed terms, $\unfold(t)=_\alpha\tercoden{\terden t}$.



\begin{ALdefinition}
The \emph{unfolded body} $\sn(t)$ of $t$ is the largest subterm of $\unfold(t)$ not of the form $u\g$.
\end{ALdefinition}
%
%
The unfolded body of a term is what is duplicated during reduction.
%
To identify the various copies, let a \emph{variant} of a term $t$ be any term obtained from $t$ by renaming certain (bound or free) variables.
%
A variant is \emph{fresh} if all its variables are fresh, and $t^i$ is the fresh variant of $t$ obtained by replacing each
variable $x$ by a fresh variable $x^i$.


For an $n$-term $t^n=\tup t\G$ let the \emph{$i^{\mbox{\scriptsize th}}$ projection} $\pi_i(t^n)$ be the atomic lambda term $t_i\G[i]$ where $\G[i]$ is obtained by removing the binders from $\G$ binding in any $t_j$ ($i\neq j$), and iteratively removing binders in $s_k$ when $x_k$ is removed from a distributor $\distr*{x_1,\dotsc,x_k,\dotsc,x_m}y{\tup*{s_1,\dotsc,s_k,\dotsc,s_m}\G'}$.


The following basic facts then characterise $\sn$.


\begin{ALproposition}
\[
\begin{aligned}
	\sn(x) = x \quads3
	\sn(\lambda x.t) & =\lambda x.\sn(t)\share*{\vv*x}x \quads3
	\sn((u)v) = (\sn(u))\sn(v)
\\[5pt]
   \sn(u\share xt) & =\sn(u)\subn{x_i}{\sn(t)^i}
\\[5pt]
	\sn(u\distr xy{t^n}) &=\sn(u)\subn{x_i}{\sn(\lambda y.\pi_i(t^n))^i}
\end{aligned}
\]
\end{ALproposition}


\begin{ALproposition}\label{prop:sn_pi}
For $t=\tup t\G$, $\sn(\pi_i(t))=\sn(t_i\share*{}{x_1}\dots\share*{}{x_m}\G)$ where
$\vv[m]x$ are the free variables of all $t_j$ ($i\neq j$).
\end{ALproposition}



To characterise the effects of duplication on the free variables of a term $t$ or an abstracted $n$-term $\lambda y.t^n$, let $\FV(t)=\FV(\lambda y.t^n)=\{y_1,\dots,y_k\}$, and let $\FV(\sn(t)^i)=\FV(\sn(\lambda y.\pi_i(t^n))^i)=\{\vv*y_1^{\;i},\dotsc,\vv*y_k^{\;i}\}$.
%
Define the \emph{renamings} of $t$ and $\lambda y.t^n$ to be the sharings $\share*{\vv*y_i^{\;1},\dots,\vv*y_i^{\;n}}{y_i}_{i\leq k}$, denoted $[\sh (t):1,\dots,n]$ and $[\sh(\lambda y.t^n):1,\dots,n]$ and abbreviated $[\sh(t)]$ and $[\sh(\lambda y.t^n)]$ where possible.
%
%For an $n$-term $t^n=\tup t\G$ in a distributor , the renamings $[\sh(\lambda y.t^n):1,\dots,n]$, abbreviated $[\sh(\lambda y.t^n)]$, are the sharings $\share*{\vv*y_i^{\;1},\dotsc,\vv*y_i^{\;n}}{y_i}$ where $\FV(\sn(\pi_j(t^n)))=\{\vv*y_1^{\;j},\dotsc,\vv*y_k^{\;j}\}$. 
%
The unfolded body and the renamings give the following key decomposition properties of the computational content of closures.


\begin{ALlemma}
\label{lem:unsharing}
$u\share xt \rewrite u\subn{x_i}{\sn(t)^i}[\sh (t)]$
\end{ALlemma}


\begin{ALlemma}
\label{lem:undist}
$u\distr xy{t^n} \rewrite u\subn{x_i}{\sn(\lambda y.\pi_i(t^n))^i}[\sh (\lambda y.t^n)]$
\end{ALlemma}




% =================================================================================================
\section{Typed atomic lambda-calculus}
\label{sec:types}


The simply typed atomic lambda-calculus $S_a$ is defined by the following rules (see \cite{Gundersen-Heijltjes-Parigot-2013-JFLA,Gundersen-Heijltjes-Parigot-2013-LICS}).
%
Terms, including variables, are typed $t:A$ with $A$ a \emph{minimal} formula, one built over $\vlim$, while $n$-terms are typed by \emph{conjunctive} formulae, $t^n:A_1\vlan\cdots\vlan A_n$.
%
With the notation $t^*$ indicating either a term or an $n$-term, a \emph{judgment} is of the form $x_1:A_1,\dotsc,x_n:A_n\vdash t^*:B$, where $\vv x$ are the free variables of $t^*$. 
%
The antecedent $x_1\colon A_1,\ldots,x_n : A_n$ of a judgement is treated as a set, denoted $\Gamma$, $\Delta$, and abbreviated $(x_i\colon A_i)_{i\leq n}$, or $\vv*x:A$ if $A_i=A$ for all $i$.



\bigskip
\noindent
{\bf Typing rules of $S_a$:}
\[
\begin{array}{@{}c@{}}
	\begin{array}{c@{\quads4}c}
	  \vlinf{}{\typeabs}
	   {\Gamma \vdash \lambda x.t : A \vlim B}
	   {\Gamma, x : A \vdash t : B}
	&
	  \vliiinf{}{\typeapp}
	   {\Gamma, \Delta \vdash (u)v : B}
	   {\Gamma \vdash u : A\vlim B}
	   {}
	   {\Delta \vdash v : A}
	\\ \\
	  \vlinf{}{\typevar}{x:A\vdash x:A}{}
	&
	  \vliiinf{}{\typetuple _n}
	   {\Gamma_1, \dots, \Gamma_n \vdash \langle t_1,\ldots,t_n\rangle : A_1\vlan\cdots\vlan A_n}
	   {\Gamma_1 \vdash t_1 : A_1}
	   {\quad\cdots\quad}
	   {\Gamma_n \vdash t_n : A_n}
	\end{array}
\\ \\[5pt]
  \vliiinf{}{\typeshare}
   {\Gamma, \Delta \vdash t^*\share xu : A}
   {\Gamma, (x_i : B)_{i\leq n} \vdash t^* : A}
   {}
   {\Delta \vdash u : B}
\\ \\[5pt]
  \vliiinf{}{\typedist}
   {\Gamma, \Delta \vdash s^*\distr xy{t^n} : C}
   {\Gamma, (x_i : A \vlim B_i)_{i\leq n} \vdash s^* : C}
   {}
   {\Delta, y : A \vdash t^n : B_1\vlan\cdots\vlan B_n}
\end{array}
\]


The type system $S_a$ of the atomic lambda-calculus is a refinement of the simply typed lambda-calculus $S$: the rules $\typevar$, $\typeabs$, and $\typeapp$ are the rules of $S$ restricted by the linearity condition.
%
The rule for sharing, $\typeshare$, is a standard cut-rule combined with contraction on the left.
%
Similarly, the rule for the distributor, $\typedist$, is a cut-rule, albeit a highly non-standard one.
%
It contracts on $A$, the antecedent of the implications, but not on their consequent, integrating a limited amount of deepness.


The typed atomic lambda-calculus ${S_a}$ enjoys the usual properties of typed systems, in particular subject reduction.


\begin{ALtheorem}[\cite{Gundersen-Heijltjes-Parigot-2013-JFLA}]
If $\Gamma\vdash u : A$ and $u \rewrite v$, then $\Gamma\vdash v : A$.
\end{ALtheorem}

\noindent
Moreover, types are preserved in the interpretation of standard lambda-terms as atomic lambda-terms, by inserting sharing-inferences $(\typeshare)$ where required.

\begin{ALproposition}\label{prop:types preserved}
If $\Gamma\vdash N:A$, then $\Gamma\vdash \tercoden N:A$
\end{ALproposition}


Despite the fact that sharing reductions are strongly normalising, commute with denotation, and preserve typing, preservation of strong normalisation (PSN) is not immediate since infinite reduction may take place within weakenings: consider the denotation $\terden{ x\share*{}t}=x$ where $t$ is not SN.
%
%Also, SN for the simply typed atomic lambda-calculus does not follow from PSN, since not all atomic lambda-terms are reachable by reduction from the translation of a lambda-term.



% =================================================================================================
\section{Proof of Strong Normalisation for Simple Types}
\label{sec:SNproof}

In this section we prove the strong normalisation theorem for atomic lambda-terms, typed in the system $S_a$, using Tait's reducibility method. 
%
The proof of the main proposition (Proposition~\ref{prop:IntSubst}) relies on closure properties of the reducibility sets (Lemma~\ref{lem:IntCaseLambdaSharing}), which again relies on closure properties on the set of strongly normalisable atomic lambda terms proved in Section~\ref{sec:ClosPropSN}.


For simplifying the presentation, we consider in the remainder of this paper, that no beta-reduction happens inside $n$-tuples, that $n$-tuples are unfolded, and that all their free variables are captured by closures. This property is preserved by reduction and it is natural in the context of sharing calculus. In particular all the useful computation strategies satisfy it, including the one reproducing fully lazy sharing.

%For simplifying the presentation, we consider in the remainder of this paper, that terms of multiplicity $n$ are of the form $\langle t^1,\dots, t^n \rangle\G$ with $t$ unfolded. This means in particular that we do not compute inside $\tup*\cdot$. This restriction is natural in the context of sharing calculus and all the useful computation strategies satisfy it, in particular the one reproducing fully lazy sharing.


\begin{ALdefinition}
The \emph{value} $|A|$ of a formula $A$ is defined inductively by:
\[
\begin{array}{lll}
|X| & = & \mathcal{N}
\\
%|A\cap B| & = & |A| \cap |B|
%\\
|A\vlim B| & = & \mbox{\{$u$ \;|\;  $u$ is a term and, for each term $v\in |A|$, $(u)v \in |B|$ \}}
\end{array}
\]
Values are extended to conjunctive formulae by the following clauses, for $n>0$.
%
We denote by $\VAR$ the set of variables, and note that $\tup*{}$ is the empty tuple.
%
\[
\begin{array}{lll}
|A_1\vlan\dots\vlan A_n| & = & \mbox{\{$t^n$ \;|\; for each $i\leq n$, $\pi_i(t) \in |A_i|$\}}
\\
|\top| & = & \mbox{\{$\tup*{}\G$ \;|\; for any $x\in\VAR$, $x\G\in\SN$\}}
\end{array}
\]
\end{ALdefinition}
%
%
Values of formulae are called {\em reducibility sets}. 
%
Note that if $t\in|A|$ and $t'$ is a variant of $t$, then $t'\in|A|$.


\begin{ALproposition}\label{prop:IntBase}
For each formula $A$, $\VAR \subseteq |A| \subseteq  \SN$
\end{ALproposition}

\begin{ALproposition}
 For any formulae $A_1,\dots,A_n$, $|A_1\vlan\dots\vlan A_n| \subseteq \SN$.
\end{ALproposition}


For convenience, the lemmata in the remainder of the paper will be stated in the way they are used. 
%
Many will however require a stronger induction hypothesis. 
To this end, let $\cxt\overline w$ denote a term context consisting of repeated applications, so that $\cxt*u\overline w$ is $(\dotso(u)w_1\dotso )w_n$.


\begin{ALlemma}\label{lem:RedStab}
For any formula $A$,  if $u\in |A|$ and $u \rightsquigarrow v$, then $v \in |A|$ .
\end{ALlemma}

\begin{proof}
 Immediate by induction on $A$.
\end{proof}

\begin{ALlemma}\label{lem:Red-AddSharings}
For any formula $B$,  if $u\in |B|$ then $u\share*{\vv*x}y \in |B|$.
\end{ALlemma}

\begin{proof}
By induction on $B$, in the context $\{\cdot\}\overline w$.
\end{proof}

\begin{ALlemma}\label{lem:IntCaseLambdaSharing}
~
\begin{compactenum}[\upshape(i)]
%
\item If $u\{v/x\} \in |B|$ and $x\in\FV(u)$, then $(\lambda x.u) v \in |B|$.
\\[-9pt]
\item If $u\subn{x_i}{\sn(t)^i}[\sh (t)] \in |B|$ and $t\in\SN$, then $u[x_1,\dots,x_n \leftarrow t] \in |B|$.
\\[-9pt]
\item If $u\subn{x_i}{\sn(\lambda y.\pi_i(t^n))^i}[\sh (\lambda y.t^n)] \in |B|$ and $t^n\in\SN$, \\
\\[-9pt]	then $u\distr xy{t^n} \in |B|$.
%
\end{compactenum}
%
\end{ALlemma}

\begin{proof}
Each case is proved by induction on $B$, using context $\{\cdot\}\overline w$.

(i) If $B$ is a variable, $|B| = \SN$ and the result is given by Lemma~\ref{lem:IntCaseLambda0}.
%
Otherwise, let $B= C\vlim D$.
%
Suppose $(u\{v/x\})\overline{w} \in |C\vlim D|$ and $x\in\FV(u)$.
%
Let $t\in|C|$. 
%
We prove that  $(((\lambda x.u) v)\overline{w})t \in |D|$.
%
Because $(u\{v/x\})\overline{w} \in |C\vlim D|$ and $t\in|C|$, we have $((u\{v/x\})\overline{w})t \in |D|$ and by the induction hypothesis, $(((\lambda x.u) v)\overline{w})t \in |D|$.
%
It follows that $((\lambda x.u) v)\overline{w} \in |C\vlim D|$.


(ii) If $B$ is a variable, $|B| = \SN$ and the result is given by Lemma~\ref{lem:IntCaseSharing0}.
\\
Otherwise, let $B= C\vlim D$.
%
Let $u'=(u\subn{x_i}{\sn(t)^i}[\sh (t)])\overline{w} \in |C\vlim D|$ and $t\in\SN$.
%
Let $v\in|C|$.
%
We prove that $((u\share xt)\overline{w})v \in |D|$.
%
By the definition of $|C\vlim D|$ we have $(u')v\in|D|$.
%
By the induction hypothesis $((u[x_1,\dots,x_n \leftarrow t])\overline{w})v \in |D|$.
%
It follows that $(u[x_1,\dots,x_n \leftarrow t])\overline{w} \in |C\vlim D|$.
%\\

(iii) The proof is similar to that of (ii).
%
\end{proof}

\begin{ALproposition}\label{prop:IntSubst}
%If $x_1:A_1,\ldots, x_n:A_n \vdash u:B$ and $v_1 \in |A_1|, \dots, v_n \in |A_n|$, then $u\{v_1/x_1, \dots, v_n/x_n\} \in |B|$.
If $(x_i:A_i)_{i\leq n}\vdash u:B$ and $v_i \in |A_i|$, then $u\subn{x_i}{v_i} \in |B|$.

\end{ALproposition}

\begin{proof}
%
We proceed by induction on the derivation of $(x_i:A_i)_{i\leq n}\vdash u:B$.
%
\begin{enumerate}
\setlength{\itemsep}{\medskipamount}%
\setlength{\parskip}{0pt}

	\item
The last rule is $\typevar$, with conclusion $x:A\vdash x:A$.
%
For $v\in|A|$ we have $x\{v/x\} = v\in|A|$.


	\item
The last rule is
\[
  \vliiinf{}{\typeapp}
	{(x_i:C_i)_{i\leq n},(y_j:D_j)_{j\leq m}\vdash (t)u : B}
	{(x_i:C_i)_{i\leq n}\vdash t : A\vlim B}
	{}
	{(y_j:D_j)_{j\leq m}\vdash u : A}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq n$ and $j\leq m$.
%
By the induction hypothesis, $t\subn{x_i}{v_i}\in|A\vlim B|$ and $u\subn[m][j]{y_j}{w_j}\in|A|$.
%
By the definition of $|-|$,
%
\[
	((t)u)\subn{x_i}{v_i}\subn[m][j]{y_j}{w_j} = (t\subn{x_i}{v_i})u\subn[m][j]{y_j}{w_j} \in|B|\;.
\]


	\item
The last rule is
\[
  \vlinf{}{\typeabs}
	{(x_i:C_i)_{i\leq n} \vdash \lambda x.t : A \vlim B}
	{(x_i:C_i)_{i\leq n}, x : A \vdash t : B}
\]
Let $v_i \in |C_i|$ for $i\leq n$, and suppose $w\in |A|$. 
%
By the induction hypothesis we have $t\subn{x_i}{v_i}\sub xw\in|B|$. 
%
By Lemma~\ref{lem:IntCaseLambdaSharing}, $(\lambda x.t\subn{x_i}{v_i})w \in |B|$.
%
It follows that 
\[
	(\lambda x.t)\subn{x_i}{v_i} = \lambda x.t\subn{x_i}{v_i}\in | A\vlim B|\;.
\]


	\item
The last rule is
\[
  \vliiinf{}{\typeshare}
	{(y_i:C_i)_{i\leq k}, (z_i:D_i)_{i\leq m} \vdash u\share xt : A}
	{(y_i:C_i)_{i\leq k}, (x_i:B)_{i\leq n} \vdash u : A}
	{}
	{(z_i:D_i)_{i\leq m} \vdash t : B}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq k$ and $j\leq m$, and let $u'= u\subn[k]{y_i}{v_i}$ and $t'=t\subn[m][j]{z_j}{w_j}$.
% 
We have to prove that the following term is in $|A|$:
\[
	(u\share xt)\subn[k]{y_i}{v_i}\subn[m][j]{z_j}{w_j}= u'\share x{t'}\;.
\]
By the induction hypothesis, $t'\in|B|$; then by Lemma~\ref{lem:RedStab} also the unfolded body $\sn(t')$ is in $|B|$.
%
Let $\sn(t')^1,\dotsc,\sn (t')^n$ be fresh variants.
%
By the induction hypothesis,
$
	u'\subn{x_i}{\sn(t')^i}\in|A|
$,
and $u'\subn{x_i}{\sn(t')^i}[\sh(t')]\in|A|$ by Lemma~\ref{lem:Red-AddSharings}.
%
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $u'\share x{t'}\in |A|$.


	\item
The last rule is
\[
\hspace{-\leftmargin}
  \vliiinf{}{\typedist}
	{(y_i:C_i)_{i\leq k}, (z_i:D_i)_{i\leq m} \vdash u\distr xy{t^n} : C}
	{(y_i:C_i)_{i\leq k}, (x_i:A \vlim B)_{i\leq n} \vdash u : C}
	{\hspace{-6pt}}
	{(z_i:D_i)_{i\leq m}, y : A \vdash t^n : B\vlan\cdots\vlan B}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq k$ and $j\leq m$, and let $u'=u\subn[k]{y_i}{v_i}$ and $t'=t^n\subn[m][j]{z_j}{w_j}$.
%
We have to prove that the following term is in $|C|$:
\[
	(u\distr xy{t^n})\subn[k]{y_i}{v_i}\subn[m][j]{z_j}{w_j}=u'\distr xy{t'}\;.
\]
%
% The $n$-term $u^n$ is of the form $\tup*{t^1,\dotsc, t^n}\G$ with each $t^i$ a fresh variant of an unfolded term $t$.
%
% Let $t'=t\G\subn[m][j]{z_j}{w_j}$.
%
By the induction hypothesis,
$
	t'\sub ys \in|B\vlan\cdots\vlan B|
$
for each $s\in |A|$,
%
and therefore $\pi_i(t'\sub ys)=\pi_i(t')\sub ys\in|B|$.
%
Then, for each $s\in |A|$, $(\lambda y.\pi_i(t'))s \in|B|$ by Lemma~\ref{lem:IntCaseLambdaSharing}, and by definition of $|-|$, $\lambda y.\pi_i(t')\in|A\vlim B|$.
%
By Lemma~\ref{lem:RedStab} also the unfolding of $\lambda y.\pi_i(t')$ belongs to $|A \vlim B|$, as does any variant $\sn(\lambda y.\pi_i(t'))^i$.
%
By the induction hypothesis, $u'\subn{x_i}{\sn(\lambda y.\pi_i(t'))^i}$ is in $|C|$, and by Lemma~\ref{lem:Red-AddSharings},
$
	u'\subn{x_i}{\sn(\lambda y.\pi_i(t'))^i}[\sh(\lambda y.t^n)]\in|C|.
$
%
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $u'\distr xy{t'}\in|C|$.
%
\end{enumerate}


\end{proof}

\begin{ALtheorem}\label{thm:SN}
%If $x_1:A_1,\dots, x_n:A_n \vdash u:B$ then $u \in \SN$.
If $(x_i:A_i)_{i\leq n} \vdash u:B$ then $u \in \SN$.
\end{ALtheorem}



\begin{proof}
%
Suppose $(x_i:A_i)_{i\leq n} \vdash u:B$.
%
By Proposition~\ref{prop:IntBase}, we have $x_i\in |A_i|$ for $i\leq n$.
%
Therefore by Proposition~\ref{prop:IntSubst},  $u\subn{x_i}{x_i}\in |B|$, i.e.\ $u \in |B|$, and by Proposition~\ref{prop:IntBase} we have $u \in \SN$.

\end{proof}


% =================================================================================================
\section{Closure properties of Strongly Normalisable Atomic Lambda Terms}
\label{sec:ClosPropSN}


In this section we prove closure properties for the set of strongly normalisable atomic lambda terms
which are used in Section~\ref{sec:SNproof}.
%
To strengthen the induction hypothesis in several lemmata we define a further context, $\cxt\overline {w\G}$, given by the following grammar.
%
\setMidspace{10pt}
\[
	* \Coloneq  \cxt \Mid (*)u \Mid *\g
\]


\begin{ALlemma}\label{lem:HeadVar}
If $x\in \VAR$ and in $\cxt\overline w$ each $w_i\in\SN$, then
$(x)\overline{w} \in \SN$.
\end{ALlemma}
%
%For each term $u \in \SN$, we denote $S(u)$ the sum of the lengths of the reduction sequences of $u$ leading to a normal form. The length $lh(t)$ of a term $t$ is defined in the usual way, except that in a distributor, the length of its body $\lambda y.\tup t\G$ is defined as the max of the length of each $t_i\G$.
%%
%We denote by $\overline{w\G}$ a (possibly empty) sequence $w_1[\Gamma_1]\dots w_n[\Gamma_n]$, where $w_1,\dots ,w_n$ are terms (we suppose that a non-empty sequence  $\overline{w\G}$ has at least one term $w_1$).
%By $(u)\overline{w\G}$, we mean $((...(((u)w_1)[\Gamma_1])\dots )w_n)[\Gamma_n]$; thus, each $\G[i]$ may bind not only in $w_i$, but also in $u$, and in all $\G[j]$ and $w_j$ for $j<i$.
%

For each term $t\in\SN$, we denote by $B(t)$ the sum of the number of $\beta$-steps in all reduction sequences of $t$ to a normal form.
%
For any term $t$, we denote by $S(t)$ the number of sharing-reduction steps in all reduction paths to $\unfold(t)$.

%
\begin{ALlemma}\label{lem:IntCaseLambda0}
If $(u\sub xv)\overline w \in \SN$ and $x\in\FV(u)$, then $((\lambda x.u)v)\overline w \in \SN$.
%If $((u\sub xv)\G\G')\overline{w\G} \in \SN$, then $((((\lambda x.u)\G) v)\G')\overline{w\G} \in \SN$.
\end{ALlemma}

\begin{proof}
The context $\cxt\overline w$ is strengthened to $\cxt\overline{w\G}$, and further closures are inserted.
%
It will be shown that if $T'\in\SN$ then $T\in\SN$, where
\[
	T = (((\lambda x.u)\G) v)\overline{w\G} \qquad T' = (u\sub xv\G)\overline{w\G}
\]
%
For any one-step reduction $T\rewrite^1 U$ reductions $T'\rewrite U'$ and $U\rewrite U'$ will be given, such that the induction hypothesis applies to $U$ and $U'$, giving $U\in\SN$.
%
Since this holds for any step $T\rewrite^1 U$, it follows that $T\in\SN$.
%
The measure for the induction is the pair $(B(T'),S(T))$.

The first, special case, is $T'=U$ (with $\G$ empty), for which $U\in\SN$ is immediate.
%
For the following cases, $S(U) < S(T)$.

\begin{enumerate}

	\item % 3)
If $T\rewrite^1 U$ is an application of permutation rule \eqref{eqn:sharing above abstraction} to $\g$ in $\lambda x.u'\g$, where $u=u'\g$, then $U$ and $U'$ are as follows.	
\[
	U = (((\lambda x.u')\g\G) v)\overline{w\G}
\qquad
	U'= (u'\sub xv\g\G)\overline{w\G}
\]

	\item % 6)
If $T\rewrite^1 U$ is an application of permutation rule \eqref{eqn:sharing above application function} to $\g$ in $((\lambda x.u)\G'\g)v$, where $\G=\G'\g$, then $U$ and $U'$ are as follows (note that $T'=U'$).
\[
	U = ((((\lambda x.u)\G') v)\g)\overline{w\G}
\qquad	
	U'= (u\sub xv\G'\g)\overline{w\G}
\]

	\item % 7)
If $T\rewrite^1 U$ is an application of permutation rule \eqref{eqn:sharing above application argument} to $\g$ in $((\lambda x.u)\G)v'\g$, where $v=v'\g$, then $U$ and $U'$ are as below.
%
Note that $U'\rewrite T'$ by permuting $\g$ outward, from $u\sub x{v'\g}$ to $u\sub x{v'}\g$.
%
\[
	U = ((((\lambda x.u)\G) v')\g)\overline{w\G}
\qquad
	U'= (u\sub x{v'}\G\g)\overline{w\G}
\]
\end{enumerate}

\newpage


%
%\[
%\begin{array}{c@{\qquad\qquad}c}
%	(((\lambda x.u')\G) v')\overline{w'[\Gamma']}
% &  (u'\sub x{v'}\G)\overline{w'[\Gamma']}
%\\[5pt]
%	(((\lambda x.u')\g\G) v)\overline{w\G}
% &	(u'\sub xv\g\G)\overline{w\G}
%\\[5pt]
%	(((\lambda x.u)[\Gamma']) v)\overline{w\G}
% &	(u\sub xv[\Gamma'])\overline{w\G}
%\end{array}
%\]



%
%We prove a stronger version of the lemma by considering instead the terms $T = ((((\lambda x.u)\G) v)\G')\overline{w\G}$ and $T' = ((u\sub xv)\G\G')\overline{w\G}$.
%%
%To show that $T\in\SN$, it must be shown that each one-step reduction from $T$ gives a term $U\in\SN$.
%%
%This can be shown by induction on $Mes(T) = (S(T'), lh(u), lh(v), \lh\G)$ where $\lh\G$ is the length of the sequence $\G$.
\end{proof}

\newcommand{\term}{{\mathsf{t}}}

To each closure $\g$, we associate its \emph{term} $t(\gamma)$ and its \emph{computation} $\g^v$, defined as follows:
\begin{itemize}

	\item
If $\g = \share xt$, then $t(\gamma) = t$ and $\g^v = \subn{x_i}{\sn(t)^i}[\sh (t)]$

	\item
If $\g = \distr xy{t^n}$, then  $t(\gamma) = \lambda y.t^n$\\ and $\g^v = \subn{x_i}{\sn(\lambda y.\pi_i(t^n))^i}[\sh (\lambda y.t^n)]$.
\end{itemize}

\begin{ALlemma}\label{lem:CompSubst}
 $\g^v\sub xw \rightsquigarrow [\gamma\sub xw]^v$
\end{ALlemma}

\begin{proof}
Immediate by definition.
\end{proof}

For $\G = \g[1]\dots\g[p]$, we denote by $\G^*$ the sequence $\g[1]^* \dots\g[p]^*$, where $\g[i]^*$ is either $\g[i]$ or $\g[i]^v$.


\begin{ALlemma}\label{lem:IntCaseSharing0}
% If $u\G[0]^*)\overline{w\G^*} \in \SN$ and for each closure $\g$ of $\G[0]\overline{\G}$,  $\term (\gamma)\in\SN$, then $(u\G[0])\overline{w\G} \in \SN$.
  If $u\g^v \in \SN$ and $\term (\gamma)\in\SN$, then $u\g \in \SN$.
\end{ALlemma}

\begin{proof}

  We prove a stronger version of the lemma by considering instead the terms $T = (u\G[0])\overline{w\G}$ and $T' = (u\G[0]^*)\overline{w\G^*}$, where for each
  closure $\g$ of $\G[0]\overline{\G}$, $\term (\gamma)\in\SN$.
\\
We proceed by induction on $Mes(T,T') = (S(T'), m_1(T), m_2(T))$ where

 $m_1(T)$ is the sum of the $S(t(\gamma))$ for  $\g$ in $\G[0]\overline{\G}$

 $m_2(T)$ is the sum of the $lh(t(\gamma))$ for $\g$ in $\G[0]\overline{\G}$
 \\
If,  for each closure $\g$ of $\G[0]\overline{\G}$,  $\g^* = \g$, then the result is trivial (note that if $t(\gamma)$ is a variable, then  $\g^* = \g$). We suppose in the following that $\g^* \neq \g$ for at least one$\g$ of $\G[0]\overline{\G}$ . We can also suppose that $u$ doesn't end with a closure, because it can be integrated in the sequence $\G[0]$.


In order to show that $T\in\SN$, we show that each one-step reduction from $T$ gives a term $U\in\SN$. We consider the different possible reductions leading to $U$. If the reductions are inside $u$ or $\overline{w}$ we conclude as in Lemma~\ref{lem:IntCaseLambda0}. If it is the lifting of a closure $\g$ of $\G[0]\overline{\G}$ using rule (2) we conclude also as in Lemma~\ref{lem:IntCaseLambda0}. It remains to consider the different possible reductions in a closure $\g$ of $\G[0]\overline{\G}$ or the interaction of two such closures using rule (9). For simplification we consider the case where the reduction involves $\g[1]$.
%
%
\medskip
\\
1) Suppose that $U$ is obtained by the reduction a closure $\g$ such that  $\g^* = \g$. Suppose for instance that is closure $\g[i]$ of $\G[0] = \g[1] \dots\g[p]$. This reduction  may apply substitutions to $u$ and $\gamma_j$, for $j<i$, transforming them into $u^S$ and $\gamma_j^S$. We have in this case $U = (u^S\g[1]^S \dots [\gamma'_i]\dots \g[p])\overline{w\G}$.
\\
Consider $U' = (u^S\g[1]^{S*} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*}$ (note that that by $\g[1]^{S*}$ we mean that we apply first the substitution and then computation, and by $\g[1]^{*S}$, the converse).  We have:\quad
$
\begin{array}[t]{llll}
 T' & = & (u\g[1]^* \dots\g[p]^*)\overline{w\G^*} & \\
    & \rightsquigarrow^1 & (u^S\g[1]^{*S} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*} & \\
    & \rightsquigarrow & (u^S\g[1]^{S*} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*} & \hspace{0.5cm} \mbox{by Lemma~\ref{lem:CompSubst}  }\\
    & = & U' &
\end{array}
$
\\
Therefore $U'\in\SN$ and $S(U')<S(T')$. Because $Mes(U,U') < Mes(T,T')$, we have by the induction hypothesis, $U\in\SN$.
%
%
\medskip
\\
2) Suppose that $U$ is obtained by the reduction of a closure $\g$ such that $\g^* = \g^v$.
%
For simplicity let $\g=\g[1]$, the first closure of $\G[0]$, and $\G[0] = \g[1]\G'[0]$.
\smallskip
\\
2.1)  $T = (u\share xt\G'[0])\overline{w\G}$ and $U = (u\share x{t'}\G'[0])\overline{w\G}$ with $t\rightsquigarrow^1 t'$.
%
In this case $T' = (u\subn{x_i}{\sn(t)^i}[\sh (t)]\G'[0]^*)\overline{w\G^*}$.
%
Consider $U' = (u\subn{x_i}{\sn(t')^i}[\sh (t')]\G'[0]^*)\overline{w\G^*}$. We have $\sh (t') = \sh (t)$ and by Lemma~\ref{lem:lift-sn}, $\sn (t) \rightsquigarrow \sn (t')$. Therefore $T'\rightsquigarrow U'$ and $U'\in\SN$. We have also $S(U')\leq S(T')$ and $S(t')<S(t)$. It follows that  $m_1(U) < m_1(T)$ and  $Mes(U,U') < Mes(T,T')$ and we have by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.2)
$T =  (u\distr xyt\G'[0])\overline{w\G}$ and
$U =  (u\distr xy{t'}\G'[0])\overline{w\G}$, with $t ~\rewrite^1~ t'$.
In this case
$T' = (u\subn{x_i}{\sn(\lambda y.\pi_i(t))^i}[\sh(\lambda y.t)]\G'[0]^*)\overline{w\G^*}$.
Consider
$U' = (u\subn{x_i}{\sn(\lambda y.\pi_i(t'))^i}[\sh(\lambda y.t')]\G'[0]^*)\overline{w\G^*}$.
Since $[\sh(\lambda y.t)]=[\sh(\lambda y.t')]$, by Lemma \ref{lem:lift-sn}
$\sn(\lambda y.\pi_1(t)) \rewrite^\star \sn(\lambda y.\pi_1(t'))$.
Therefore $T'\rewrite U'$ and $U'\in\SN$. We have also that
$S(U')\leq S(T')$ and $S(t') < S(t)$. It follows that $m_1(U)<m_1(T)$
and $Mes(U,U') < Mes(T,T')$ and we have by the induction hypothesis,
$U\in\SN$.
%
% 2.2)  $T = (u[x_1,\dots,x_n \leftarrow (t)v]\G'[0])\overline{w\G}$ and
% \\
% $U = (u\{(\alpha_1)\beta_1 /x_1,\dots, (\alpha_n)\beta_n/x_n\}[\alpha_1,\dots,\alpha_n \leftarrow t][\beta_1,\dots,\beta_n \leftarrow v]\G'[0])\overline{w\G}$.
% \\
% In this case $T' = (u\{\sn((t)v)^1/x_1,\dots,\sn((t)v)^n/x_n\}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$.
% \\
% Consider $U' = (u\{(\alpha_1)\beta_1 /x_1,\dots, (\alpha_n)\beta_n/x_n\}
% \{\sn(t)^1/\alpha_1,\dots,\sn(t)^n/\alpha_n\}[\sh(t)]\{\sn(v)^1/\beta_1,\dots,\sn(v)^n/\beta_n \leftarrow v\}[\sh(v)]\G'[0]^*)\overline{w\G^*}$.
% \\
% We have
% \begin{eqnarray*}
%  U' & = & (u \{(\sn (t)^1)\sn (v)^1 /x_1,\dots, (\sn (t)^n)\sn(t)^n/x_n\}[\sh(t)][\sh(v)]\G'[0]^*)\overline{w\G^*}\\
%     & = & (u\{\sn((t)v)^1/x_1,\dots,\sn((t)v)^n/x_n\}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*} \\
%     & = & T'
% \end{eqnarray*}
% Therefore $U'\in\SN$ and $S(U') = S(T')$. We also have  $m_1(U) \leq m_1(T)$ and because $lh(t) + lh(v) < lh((t)v)$, $m_2(U) < m_2(T)$ and  $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.3)  $T = (u\share x{(t)v}\G'[0])\overline{w\G}$ and
\\
$U = (u\subn{x_i}{(\alpha_i)\beta_i}\share\alpha t\share\beta v\G'[0])\overline{w\G}$.
%
In this case $T' = (u\subn{x_i}{\sn((t)v)^i}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u	\subn{x_i}{(\alpha_i)\beta_i}
			\subn{\alpha_i}{\sn(t)^i}[\sh(t)]
			\subn{\beta_i}{\sn(v)^i}[\sh(v)]
			\G'[0]^*
		  )\overline{w\G^*}
\]
We have:\quad
\begin{tabular}[t]{rclcl}
 $U'$ & $=$ & $(u\subn{x_i}{(\sn (t)^i)\sn (v)^i}[\sh(t)][\sh(v)]\G'[0]^*)\overline{w\G^*}$
\\    & $=$ & $(u\subn{x_i}{\sn((t)v)^i}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$
      & $=$ & $T'$\;.
\end{tabular}\\
Therefore $U'\in\SN$ and $S(U') = S(T')$. Since $lh(t) + lh(v) < lh((t)v)$, it follows that $m_2(U) < m_2(T)$, and since we also have $m_1(U) \leq m_1(T)$, we have $Mes(U,U') < Mes(T,T')$. Then by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.4)  $T = (u\share x{\lambda y.t}\G'[0])\overline{w\G}$ and
\\
$U = (u\distr xy{\tup\alpha\share\alpha t}\G'[0])\overline{w\G}$.
%
In this case $T' = (u\subn{x_i}{\sn(\lambda y.t)^i}[\sh(\lambda y.t)]\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u\subn{x_i}{\sn(\lambda y.\alpha\share*\alpha t)^i}[\sh(\lambda y.\alpha[\alpha \leftarrow t])]\G'[0]^*)\overline{w\G^*}
\]
%
% NOTE: I made the $\lambda y.\alpha\share*\alpha t$ into variants 
%
We have  $U' = (u\subn{x_i}{\sn(\lambda y.t)^i}[\sh (\lambda y.t)]\G'[0]^*)\overline{w\G^*} = T'$.
%\EMPTY{(check this equality)}
%
Therefore $U'\in\SN$ and $S(U') = S(T')$. We also have $m_1(U) \leq m_1(T)$, and $m_2(U) < m_2(T)$ because $\lh(\lambda y.\tup\alpha\share\alpha t) = \lh(t) < \lh(\lambda y.t)$, which gives us $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.5)  $T = (u\distr xy{\tup t\share*{\vv{\vv*z}}y}\G'[0])\overline{w\G}$ and
\\
$U = (u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}\G'[0])\overline{w\G}$.
%
In this case we have $T' = ( u\subn{x_i}{\sn(\lambda y_i.t_i\share*{\vv*z_i}y_i)}\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}\G'[0]^*)\overline{w\G^*}
\]
%
Because $t_i$ is already in sharing normal form, we have $\sn(\lambda y_i.t_i\share*{\vv*z_i}y_i) = \lambda y_i.t_i\share*{\vv*z_i}{y_i}$.
%
It follows that $T' = U'$, $U'\in\SN$ and $S(U') = S(T')$.
%
Since $m_1(U) < m_1(T)$ it follows that $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
%
%
%
\medskip
\\
3)  Suppose that U is obtained by the interaction of the two first closures of $\G[0]$ using rule (9). It is enough to consider only the non-trivial case where the term of the second closure is not a variable. We have
%
\begin{align*}
	T &= (u[y_1,\dots,y_m  \leftarrow x_1][x_1,x_2\dots,x_n \leftarrow t]\G'[0])\overline{w\G} \\
	U &= (u[y_1,\dots,y_m,x_2\dots,x_n \leftarrow t]\G'[0])\overline{w\G}\;.
\end{align*}
%
Let $\vv[p]z$ be the free variables of $t$. By our renaming convention, the free variables of $\sn(t)^i$ are $\vv[p]{z^i}$. In the following we will have to consider $\sn (\sn (t)^1)^j$. Because $\sn(t)$ is unfolded, $\sn(\sn(t)) = \sn(t)$ and $\sn (\sn (t)^1)^j$ is obtained from $\sn(t)$ by replacing any variable $x$ by $(x^1)^j$: we will  adopt the notation $x^{1,j}$ for $(x^1)^j$ and $\sn(t)^{1,j}$ for $\sn (\sn (t)^1)^j$.
%
We have
%
\begin{eqnarray*}
 T' & = & (u\share[m]y{x_1}\subn{x_i}{\sn(t)^i}[\sh(t):1,\dotsc,n]\G^*)\overline{w\G^*} \\
    & = & (u\share[m]y{\sn(t)^1}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}[\sh(t):1,\dotsc,n]\G^*)\overline{w\G^*} \\
    & \rightsquigarrow 
    	& (u\subn[m][j]{y_j}{\sn(t)^{1,j}}[\sh (t^1):(1,1),\dotsc,(1,m)] \\
    &   & \quads4 \sub{x_i}{\sn(t)^i}_{2\leq i\leq n}[\sh (t):1,\dots,n]\G^*)\overline{w\G^*} \\
    & = & (u\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n} \\
    &   & \quads4 [\sh (t^1):(1,1),\dots,(1,m)][\sh (t):1,\dots,n]\G^*)\overline{w\G^*}
\end{eqnarray*}
%
Let $u' = u\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}$.
%
We have
%
\[
\begin{array}{rc@{}l@{}}
	\multicolumn{3}{@{}l@{}}{
		u'[\sh (t^1:(1,1),\dots,(1,m))][\sh (t:1,\dots,n)]
		%\makebox[\textwidth][l]{$u_1[\sh (t^1:(1,1),\dots,(1,m))][\sh (t:1,\dots,n)]$}}
	}
\\[4pt]
	&=&	u'	\share*{z_i^{1,1},\dotsc, z_i^{1,m}}{z_i^1}_{i\leq p}
			\share*{\vv^{z_i}}{z_i}_{i\leq p}
\\[4pt]
	&{}\rightsquigarrow{}&
		u'	\share*{z_i^{1,1},\dotsc, z_i^{1,m}, z_i^2,\dots,z_i^n}{z_i}_{i\leq p}
\\[4pt]
	&=&	u'[\sh (t):(1,1),\dotsc,(1,m),2,\dotsc,n]\;.
\end{array}
\]
%
Consider 
$
	U' = (u'%\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}
		 [\sh (t):(1,1),\dots,(1,m),2,\dots,n]\G^*)\overline{w\G^*}
$.
We have $T'\rightsquigarrow U'$ and therefore $U'\in\SN$; because $t$ is not a variable, $S(U')<S(T')$.
%\TODO{check in the limit cases (eg nullary sharings) that there is always one step of reduction}
Because $Mes(U,U') < Mes(T,T')$, we have by the induction hypothesis, $U\in\SN$.


\end{proof}






% 
% =================================================================================================
\section{Conclusions and further work}



The present result, of strong normalisation for the atomic lambda-calculus with intersection types, emphasises how the calculus is a natural and well-behaved formalisation of sharing in the lambda-calculus.
%
Future investigations will expand in three directions: strengthening the current strong normalisation result; adapting the atomic lambda-calculus to address further notions of sharing; and investigating the practical use of the calculus in computation, for instance in compiling or implementing functional programming languages.



The present work strongly suggests an angle for future research: it is expected that the type system and strong normalisation proof can be extended to the second-order case---although subject reduction is not immediately obvious.% in this case.%, where type inference (in e.g.\ a  Hindley--Milner type system) becomes useful


For the atomic lambda-calculus in general, further work will focus on variations on the calculus that more closely approach the reduction dynamics of sharing graphs, to encompass further degrees of sharing.
%
Another direction would be the inclusion of general recursion in the calculus, and the investigation of its interaction with the sharing constructs, as a prerequisite of making the calculus useful in practice to the implementation of functional programming languages.



\bibliographystyle{plain}
\bibliography{AL-LPAR}

\newpage

\include{appendix}



\end{document}







