% Preempt some bad decisions by LLNCS
\RequirePackage{fixllncs}


\documentclass[orivec]{llncs}


% To get cases in equations
\usepackage{amsmath}

% To use definitions, lemmas and theorems.
%\usepackage{amsthm}

% twoheadleftarrow
\usepackage{amssymb}

% Nicer array and tabular layout (IEEE-suggested)
\usepackage{array}

% A more pleasant font
\usepackage[T1]{fontenc} % use postscript type 1 fonts
\usepackage{textcomp} % use symbols in TS1 encoding
%\usepackage[garamond]{mathdesign} % use a nice font

% A taste of french
%\usepackage[french]{babel}
\usepackage[utf8]{inputenc}

% Allow inclusion of graphics
%\usepackage[pdftex]{graphicx}

% To get url's
%\usepackage[hidelinks]{hyperref}

% Improves the text layout
\usepackage{microtype}

% For in-line lists
\usepackage{paralist}

% To typeset derivations
\usepackage[lutzsyntax,pdftex]{virginialake}

% Landscape-orientated floats
\usepackage{rotating}

% To get semantic brackets
\usepackage{stmaryrd}

% For fancy underlining and strikethroughs
\usepackage[normalem]{ulem}

% Nice fractions
\usepackage{units}

% For commands with multiple optional arguments
\usepackage{xargs}

% Our own stuff
\usepackage{ALmacros}
%\usepackage{includeFigure}
%\input{ALpictures}
\usepackage{willemtools}

% Get counters and fonts right for theorem environments
\spnewtheorem{ALtheorem}{Theorem}{\bfseries}{\itshape}
\spnewtheorem{ALdefinition}[ALtheorem]{Definition}{\bfseries}{\upshape}
\spnewtheorem{ALproposition}[ALtheorem]{Proposition}{\bfseries}{\itshape}
\spnewtheorem{ALlemma}[ALtheorem]{Lemma}{\bfseries}{\itshape}


\newif\ifnonotes\nonotesfalse
\newcommand{\EMPTY}[1]{\ifnonotes\else{\color{red}    \noindent #1}\fi}
\newcommand{\Comment}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Comment: }#1}\fi}
\newcommand{\Remark}[1]{\ifnonotes\else{\color{red}    \noindent{\bf Remark: }#1}\fi}
\newcommand{\TODO}[1]{\ifnonotes\else{\color{red}    \noindent{\bf TODO }#1}\fi}
%\newcommand{\Rem}[1]{\ifnonotes\else{\color{red}    \bigskip\\{\bf Remark: }#1 \bigskip\\}\fi}
%\nonotestrue % If this is commented, notes appear in the paper (if any)
%---------------------------------------------------------- REMOVE WHEN FINISHED



%-------------------------- FRONTMATTER

\title{A Proof of Strong Normalisation of the Typed Atomic Lambda-Calculus}

\author{Tom Gundersen\inst{1} \and
Willem Heijltjes\inst{2} \and
Michel Parigot\inst{1}}

\authorrunning{Gundersen, Heijltjes, \& Parigot}

\institute{Laboratoire Preuves, Programmes, SystÃ¨mes \\ CNRS \& Universit\'e Paris Diderot \\ {\tt teg@jklm.no, parigot@pps.univ-paris-diderot.fr}
\and University of Bath \\ {\tt w.b.heijltjes@bath.ac.uk} }


% ==============================================================================================================================================================================


\begin{document}


\maketitle

\begin{abstract}
The atomic lambda-calculus is a typed lambda-calculus with explicit sharing, which originates in a Curry-Howard interpretation of a deep-inference system for intuitionistic logic.
%
It has been shown that it allows fully lazy sharing to be reproduced in a typed setting.
%
In this paper we prove strong normalization of the typed atomic lambda-calculus using Tait's reducibility method.
%
In addition we give a characterisation of exactly the strongly normalisable atomic lambda-terms by an intersection typing discipline.
%
%A characterisation of exactly the strongly normalisable terms by an intersection typing discipline, which proves to be extremely subtle, is outlined.
\end{abstract}


% citations to preserve:
%	\cite{Mellies-1995}

%
%One should say (in a better way that what follows) that:
% we prove two fundamental results:
%- we prove that typed atomic terms are strongly normalizing, using Tait's reducibility method;
%- strongly normalizing pure atomic terms can be characterized  using a type system with intersection;
%These results together shows that atomic lambda-calculus is  a rich mathematical object allowing to study lambda-calculus with sharing in the same way as lambda-calculus.
%(I guess, you see what I want to say ...)






% =================================================================================================
\section{Introduction}



The \emph{atomic lambda-calculus} is a typeable lambda-calculus with explicit sharing, recently introduced in \cite{Gundersen-Heijltjes-Parigot-2013-JFLA,Gundersen-Heijltjes-Parigot-2013-LICS}, developed as the Curry--Howard interpretation of a deep-inference proof system for intuitionistic logic.
%
The present paper constitutes an important step in the development of its meta-theory, by extending intersection types and Tait's reducibility method to show strong normalisation of the typed atomic lambda-calculus.
%
The primary motivation for establishing this result is to demonstrate that the atomic lambda-calculus is a natural and well-behaved calculus, to which the main standard techniques and results apply.



\emph{Sharing} is an approach to efficient computation in lambda-calculi whereby duplication of subterms is deferred in favor of reference to a common representation.
%
It is a leading principle behind, among others, explicit substitution calculi \cite{Abadi-Cardelli-Curien-Levy-1991,Lescanne-1994,David-Guillaume-2001,DiCosmo-Kesner-Polonovski-2003,Kesner-Lengrand-2007,Accattoli-Kesner-2010}, term calculi with strategies or higher-order transformations \cite{Hughes-1982,Ariola-Felleisen-Maraist-Odersky-Wadler-1995}, and sharing graphs in the style of Lamping \cite{Lamping-1990,Asperti-Guerrini-1998,VanOostrom-VanDeLooij-Zwitserlood-2004}.
%
The atomic lambda-calculus represents a novel category in this range.
%
As a typeable term calculus it is an alternative to explicit substitution calculi, providing a different perspective on sharing: as in sharing graphs, sharing is evaluated \emph{atomically}, by duplicating individual constructors.
%
A salient property is that the calculus implements \emph{fully lazy sharing} \cite{Wadsworth-1971,Hughes-1982,Balabonski-2012}, a degree of sharing that, while standard, had previously been achieved in lambda-calculi only by means of external transformations.



The paper \cite{Gundersen-Heijltjes-Parigot-2013-LICS} details how the atomic lambda-calculus and its sharing mechanisms are derived from \emph{deep inference} \cite{Brunnler-Tiu-2001}, a proof methodology where inferences apply \emph{in context}, reminiscent of term rewriting.
%
Sharing in deep inference is by explicit \emph{contraction} rules, which implement atomic duplication by interacting with individual inferences.
%
By embedding natural deduction within the deep-inference formalism \emph{open deduction} \cite{Guglielmi-Gundersen-Parigot-2010}, duplication in traditional normalisation is broken up into atomic steps.
%
The atomic lambda-calculus is a direct computational interpretation of the resulting proof system.
%
The paper \cite{Gundersen-Heijltjes-Parigot-2013-LICS} further establishes the technical properties of full laziness and \emph{PSN}, preservation of strong normalisation with respect to the lambda-calculus.



In the present paper strong, normalisation for the typed atomic lambda-calculus will be proven using the Tait-reducibility method \cite{Tait-1967,ProofsAndTypes}.
%
Reducibility is an abstract method compatible with higher-order logic, whose application provides a deeper understanding of reduction and its dynamics.
%
\emph{Intersection types} \cite{Coppo-DezaniCiancaglini-1980,Pottinger-1980,Krivine-1993} further allow the characterisation of exactly the strongly normalisable terms.
%
Together, the two form an important part of the meta-theory of a calculus (for example for explicit substitution calculi, in \cite{Dougherty-Lescanne-2001,Ghilezan-Ivetic-Lescanne-Likavec-2011}).


The fact that a reducibility proof can be carried out for the atomic lambda-calculus shows the generic character of this extension
of the lambda-calculus.
%
Nevertheless, the proof is not a straightforward generalisation of the one for lambda-calculus, because one has to overcome
the lack of local confluence.
%
%I would like to add something like this to avoid that the referee says: it is only a technical
%generalization; you need only perseverance to get it; etc.
%
For compactness the proof will be carried out for a discipline of simple types, and will be shown extensible to intersection types.



The characterisation of exactly the strongly normalisable atomic lambda-terms by intersection types is more subtle than for the lambda-calculus, due to the fact that garbage collection is an integral part of the computation.
%
Such a type system is given in Section~\ref{sec:SND}, and the proof of the characterization is outlined.

%The interaction of atomic duplication rules with beta-reduction means that a certain, natural amount of garbage collection is required inbetween beta-reduction steps.
%
%As a consequence, terms are strongly normalisable that don't appear so.
%
%A characterisation to capture these terms is outlined in the last section of the paper.


% =================================================================================================
\section{The atomic lambda-calculus}
\label{sec:atomic-lambda-calculus}



The \emph{atomic lambda-calculus} introduced in \cite{Gundersen-Heijltjes-Parigot-2013-LICS} is a refined lambda-calculus, in which abstraction is split into a linear abstraction and a sharing operation.
%
Duplication and deletion proceeds locally through the evaluation of sharings.
%
The calculus consists of a standard linear lambda-calculus with a sharing construct, extended by a further construction called the \emph{distributor}.



\begin{ALdefinition}
%
The \emph{atomic lambda-calculus} $\Lambda_A$ is defined by the grammars
%
\setMidspace{10pt}
\[
\begin{array}{r@{\Coloneq}c@{\Mid}l}
	s,t,u,v,w
	&	x \Mid \lambda x.t
	&	(t)u \Mid t\g
\\[5pt]
	\g,\g*  &  \share xt  &  \distr xy{t^n}
\\[5pt]
	t^n  &  \tup t  &  t^n\g
\end{array}
\]
where
%
\begin{inparaenum}[(i)]
\item $n\geq0$, 
%
\item each variable may occur at most once,
%
\item in $\lambda x.t$, $x$ must occur in $t$ and becomes bound,
%
\item in $\lambda y.t^n$, $y$ must occur in $t^n$ and becomes bound, and
%
\item in $u\share xt$ and $u\distr xy{t^n}$, each $x_i$ must occur in $u$ and becomes bound, and likewise with $t^m$ for $u$.
%
\end{inparaenum}
%
\end{ALdefinition}

%\noindent
Terms $t$ are \emph{atomic lambda-terms}.
%
The \emph{closures} $\g$ are called respectively \emph{sharing} and \emph{distributor}, and a nullary sharing $\share*{}t$ is a \emph{weakening}.
%
Atomic lambda-terms not containing a distributor are \emph{basic} terms.
%
A sequence of closures $\g[1]\ldots\g[n]$ will be denoted $\g[i]_{i\leq n}$ or $\G$.
%
The $t^n$ are \emph{terms of multiplicity $n$} or \emph{$n$-terms}, and are of the form $\tup t\G$.
%
Where possible, terms and $n$-terms will not be distinguished, and both denoted $t,u,v$.
%
A sequence of variables $\vv x$ may be abbreviated $\vv*x$; a sharing is then denoted $\share*{\vv*x}t$.
%
Standard notions are: $\FV(u)$ is the set of free variables of $u$, and $u\sub xt$ denotes the substitution of $t$ for $x$ in $u$.
%
A series of substitutions $\sub{x_1}{t_1}\dotso\sub{x_n}{t_n}$ is abbreviated $\subn{x_i}{t_i}$.



Atomic lambda terms will be considered up to the congruence $(\sim)$ induced by~\eqref{eqn:explicit permutation} below;
note that due to linearity, both terms are only well-defined if both $\g$ and $\g*$ bind only in $t$.
%
\begin{equation}\label{eqn:explicit permutation}
	t\g\g* ~\sim~ t\g*\g
\end{equation}
%
The functions $\tercoden-\,:\,\Lambda\to\Lambda_A$ and $\terden-\,:\,\Lambda_A\to\Lambda$ translate between atomic lambda-terms and standard lambda-terms, see \cite{Gundersen-Heijltjes-Parigot-2013-LICS}.


% =================================================================================================
\subsection{Reduction rules}


Reduction in the atomic lambda-calculus, denoted $\rewrite$, consists of two parts:
\begin{inparaenum}[\upshape(i)]
 \item linear $\beta$-reduction, denoted $\ALbeta$: the usual rule (rule~\ref{eqn:beta-reduction} below) applied linearly;
 \item sharing reductions, denoted $\ALnotbeta$, comprising two kinds of rule: (a) \emph{permutations} taking closures outward (rules~\ref{eqn:sharing above abstraction}--\ref{eqn:sharing above distribution}), and (b) local \emph{transformations} that evaluate closures (rules~\ref{eqn:compound sharings}--\ref{eqn:distributor elimination}).
\end{inparaenum}

\bigskip

\noindent
{\bf Linear  $\beta$-reduction:}
%
\begin{equation}\tag{$\beta$}\label{eqn:beta-reduction}
	(\lambda x.u)t ~\ALbeta~ u\sub xt
\end{equation}



\noindent
{\bf Permutations of closures:}
%
\begin{align}\label{eqn:sharing above abstraction}
	\lambda x.t\g & ~\ALnotbeta~ (\lambda x.t)\g
		 & \text{if}~x\in\FV(t) &&&
\\\label{eqn:sharing above application function}
	(u\g)t & ~\ALnotbeta~ ((u)t)\g
\\\label{eqn:sharing above application argument}
	(u)t\g & ~\ALnotbeta~ ((u)t)\g
% \\\label{eqn:sharing above tuple}
% 	\tup*{t_1,\ldots,t_i\g,\ldots,t_n} & ~\ALnotbeta~ \tup t\g
\\\label{eqn:sharing above sharing}
	u\share x{t\g} & ~\ALnotbeta~ u\share xt\g
\\\label{eqn:sharing above distribution}
	u\distr xy{t^n\g} & ~\ALnotbeta~ u\distr xy{t^n}\g
		& \text{if}~y\in\FV(t^n) &&&
\end{align}



\noindent
{\bf Transformations on closures:}
%
\begin{gather}
%\label{eqn:execute unary substitution}
%	u\share*xt~\ALnotbeta~u\sub xt
%\\[5pt]
\label{eqn:compound sharings}
	u\share*{\vv*y}y\share*{\vv*x,y,\vv*z}t ~\ALnotbeta~
	u\share*{\vv*x,\vv*y,\vv*z}t
%	u\share*{\vv*x}{y_i}\share yt ~\ALnotbeta~
%	u\share*{y_1,\dots,y_{i-1},\vv*x,y_{i+1},\dots,y_n}{t}
\\[5pt]
\label{eqn:share application}
	u\share x{(v)t} ~\ALnotbeta~
	u\subn{x_i}{(y_i)z_i}\share yv\share zt
\\[5pt]
\label{eqn:share abstraction}
	u\share x{\lambda x.t}~\ALnotbeta~ u\distr xx{\tup y\share yt}
\\[5pt]\notag
	u\distr xy{\tup t\share*{\vv*z}{y}}~\ALnotbeta~
	u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}
\\[5pt]
	\rule{4cm}{0pt}\mbox{where } \{\vv*z_i\} = \{\vv*z\}\cap\FV(t_i) \mbox{ for every }i\leq n
\label{eqn:distributor elimination}
\end{gather}

%
% \begin{multline}
% \label{eqn:distributor elimination 2}
% 	u\distr xy{\tup t}~\ALnotbeta~u\sub{x_1}{t'_1} \dotso \sub{x_j}{\lambda y.t_j} \dotso \sub{x_n}{t'_n} \\[5pt]
% 			\mbox{where } y\in\FV(t_j) \mbox{ and } t'_i = \lambda y_i.t_i\share*{}{y_i}
% \end{multline}
%
%\begin{remark}
%Rule~\eqref{eqn:execute unary substitution}, which evaluates unary sharings by actual substitutions, is redundant and may be considered an optimisation: its functionality is subsumed by the rules for $n$-ary sharings.
%\end{remark}
%
%\begin{remark}
%Compared to the presentation in \cite{Gundersen-Heijltjes-Parigot-2013-JFLA,Gundersen-Heijltjes-Parigot-2013-LICS} the rewrite rule to lift closures out of a tuple has been dropped (rule 5 in op.cit.), for the combined reason that it was redundant and it complicated the strong normalisation proof---see also the start of Section~\ref{sec:SNproof}.
%\end{remark}


The fact that a term $u$ reduces to $v$ in exactly $n$ steps will be denoted $u \rewrite^n v$, while an arbitrary number of steps is indicated simply by $\rewrite$.
%
A term $u$ is called \emph{strongly normalisable} if all the reductions sequences starting with $u$ are finite.
%
The set of strongly normalisable terms is denoted $\SN$.
%
Reduction in the atomic lambda-calculus commutes 1--1 with substitution, due to the linearity condition on free variables.


\begin{ALlemma}
For atomic lambda-terms $u$, $u'$, $v$ and $v'$ and variable $x \in \FV(u)$,
%
if $u \rewrite^1 u'$, then $u\sub xv \rewrite^1 u'\sub xv$; and
if $v\rewrite^1 v'$, then $u\sub xv \rewrite^1 u\sub x{v'}$.
\end{ALlemma}


% =================================================================================================
\subsection{Basic properties of the atomic lambda-calculus}
\label{ssec:basic properties}

We collect in this section the main basic properties we are using in the strong normalisation proof. The two main properties are (i) the strong normalisation property of the sharing reduction, and (ii) the  decomposition of the computational content of sharings and distributors.

\begin{ALtheorem}[{\cite[Theorem 11]{Gundersen-Heijltjes-Parigot-2013-LICS}}]
The reduction $\ALnotbeta$ is strongly normalising and confluent.
\end{ALtheorem}

\noindent
The \emph{unfolding} $\unfold(t)$ of an atomic lambda-term $t$ is its normal form under $\ALnotbeta$.
%
It is of the form $u\G$ where $\G$ are sharings $\share*{\vv*x}y$ of the free variables $y$ in $t$ that occur in shared subterms.
%
Sharing in $u$ occurs only as $\lambda y.v\share*{\vv*x}y$, of bound variables immediately within the scope of their binder, and no distributors occur.
%
%
\begin{ALdefinition}
The \emph{unfolded body} $\sn(t)$ of $t$ is the largest subterm of $\unfold(t)$ not of the form $u\g$.
\end{ALdefinition}
%
%
The unfolded body of a term is what is duplicated during reduction.
%
To identify the various copies, let a \emph{variant} of a term $t$ be any term obtained from $t$ by renaming certain (bound or free) variables.
%
A variant is \emph{fresh} if all its variables are fresh, and $t^i$ is the fresh variant of $t$ obtained by replacing each
variable $x$ by a fresh variable $x^i$.


For a tuple $t^n=\tup t\G$ let the \emph{$i^{\mbox{\scriptsize th}}$ projection} $\pi_i(t^n)$ be the atomic lambda term $t_i\G_i$ where $\G_i$ is obtained by removing the binders from $\G$ binding in any $t_j$ ($i\neq j$), and iteratively removing binders in $s_k$ when $x_k$ is removed from a distributor $\distr*{x_1,\dots,x_k,\dots,x_m}y{\tup s\G'}$.


The following basic facts then characterise $\sn$.


\begin{ALproposition}
\[
\begin{aligned}
	\sn(x) = x \quads3
	\sn(\lambda x.t) & =\lambda x.\sn(t)\share*{\vv*x}x \quads3
	\sn((u)v) = (\sn(u))\sn(v)
\\[5pt]
   \sn(u\share xt) & =\sn(u)\subn{x_i}{\sn(t)^i}
\\[5pt]
	\sn(u\distr xyt) &=\sn(u)\subn{x_i}{\sn(\lambda y.\pi_i(t))^i}
\end{aligned}
\]
\end{ALproposition}


\begin{ALproposition}\label{prop:sn_pi}
For $t=\tup t\G$, $\sn(\pi_i(t))=\sn(t_i\share*{}{x_1}\dots\share*{}{x_m}\G)$ where
$\vv[m]x$ are the free variables of all $t_j$ ($i\neq j$).
\end{ALproposition}



To characterise the effects of duplication on the free variables of a term $t$, let $\FV(t)=\{y_1,\dots,y_k\}$ and $\FV(\sn(t))=\{\vv*y_1,\dotsc,\vv*y_k\}$, and define the \emph{renamings} of an $n$-fold duplication of $t$ by $[\sh (t):1,\dots,n] = \share*{\vv*y_i^{\;1},\dots,\vv*y_i^{\;n}}{y_i}_{i\leq k}$ (abbreviated $[\sh(t)]$ where possible).
%
The unfolded body and the renamings give the following key decomposition properties of the computational content of closures.


\begin{ALlemma}
\label{lem:unsharing}
$u\share xt \rewrite u\subn{x_i}{\sn(t)^i}[\sh (t):1,\dots,n]$
\end{ALlemma}


\begin{ALlemma}
\label{lem:undist}
$u\distr xyt \rewrite u\subn{x_i}{\sn(\lambda y.\pi_i(t))^i}[\sh (\lambda y.t):1,\dots,n]$
\end{ALlemma}




% =================================================================================================
\section{Typed atomic lambda-calculus}
\label{sec:types}


The simply typed atomic lambda-calculus $S_a$ is defined by the following rules (see \cite{Gundersen-Heijltjes-Parigot-2013-JFLA,Gundersen-Heijltjes-Parigot-2013-LICS}).
%
Terms, including variables, are typed $t:A$ with $A$ a \emph{minimal} formula, one built over $\vlim$, while $n$-terms are typed by \emph{conjunctive} formulae, $t^n:A_1\vlan\cdots\vlan A_n$.
%
With the notation $t^*$ indicating either a term or an $n$-term, a \emph{judgment} is of the form $x_1:A_1,\dotsc,x_n:A_n\vdash t^*:B$, where $\vv x$ are the free variables of $t^*$. 
%
The antecedent $x_1\colon A_1,\ldots,x_n : A_n$ of a judgement is treated as a set, denoted $\Gamma$, $\Delta$, and abbreviated $(x_i\colon A_i)_{i\leq n}$, or $\vv*x:A$ if $A_i=A$ for all $i$.



\bigskip
\noindent
{\bf Typing rules of $S_a$:}
\[
\begin{array}{@{}c@{}}
	\begin{array}{c@{\quads4}c}
	  \vlinf{}{\typeabs}
	   {\Gamma \vdash \lambda x.t : A \vlim B}
	   {\Gamma, x : A \vdash t : B}
	&
	  \vliiinf{}{\typeapp}
	   {\Gamma, \Delta \vdash (u)v : B}
	   {\Gamma \vdash u : A\vlim B}
	   {}
	   {\Delta \vdash v : A}
	\\ \\
	  \vlinf{}{\typevar}{x:A\vdash x:A}{}
	&
	  \vliiinf{}{\typetuple _n}
	   {\Gamma_1, \dots, \Gamma_n \vdash \langle t_1,\ldots,t_n\rangle : A_1\vlan\cdots\vlan A_n}
	   {\Gamma_1 \vdash t_1 : A_1}
	   {\quad\cdots\quad}
	   {\Gamma_n \vdash t_n : A_n}
	\end{array}
\\ \\[5pt]
  \vliiinf{}{\typeshare}
   {\Gamma, \Delta \vdash t^*\share xu : A}
   {\Gamma, (x_i : B)_{i\leq n} \vdash t^* : A}
   {}
   {\Delta \vdash u : B}
\\ \\[5pt]
  \vliiinf{}{\typedist}
   {\Gamma, \Delta \vdash s^*\distr xy{t^n} : C}
   {\Gamma, (x_i : A \vlim B_i)_{i\leq n} \vdash s^* : C}
   {}
   {\Delta, y : A \vdash t^n : B_1\vlan\cdots\vlan B_n}
\end{array}
\]


The type system $S_a$ of the atomic lambda-calculus is a refinement of the simply typed lambda-calculus $S$: the rules $\typevar$, $\typeabs$, and $\typeapp$ are the rules of $S$ restricted by the linearity condition.
%
The rule for sharing, $\typeshare$, is a standard cut-rule combined with contraction on the left.
%
Similarly, the rule for the distributor, $\typedist$, is a cut-rule, albeit a highly non-standard one.
%
It contracts on $A$, the antecedent of the implications, but not on their consequent, integrating a limited amount of deepness.


The typed atomic lambda-calculus ${S_a}$ enjoys the usual properties of typed systems, in particular subject reduction.


\begin{ALtheorem}[\cite{Gundersen-Heijltjes-Parigot-2013-JFLA}]
If $\Gamma\vdash u : A$ and $u \rewrite v$, then $\Gamma\vdash v : A$.
\end{ALtheorem}

\noindent
Morever, types are preserved in the interpretation of standard lambda-terms as atomic lambda-terms, by inserting sharing-inferences $(\typeshare)$ where required.

\begin{ALproposition}\label{prop:types preserved}
If $\Gamma\vdash_S N:A$, then $\Gamma\vdash_{S_a} \tercoden N:A$
\end{ALproposition}


% =================================================================================================
\section{Proof of Strong Normalisation for Simple Types}
\label{sec:SNproof}

In this section we prove the strong normalisation theorem for atomic lambda-terms, typed in the system $S_a$, using Tait's reducibility method. 
%
The proof of the main proposition (Proposition~\ref{prop:IntSubst}) relies on closure properties of the reducibility sets (Lemma~\ref{lem:IntCaseLambdaSharing}), which again relies on closure properties on the set of strongly normalisable atomic lambda trems proved in Section~\ref{sec:ClosPropSN}.


For simplifying the presentation, we consider in the remainder of this paper, that no beta-reduction happens inside $n$-tuples, that $n$-tuples are on sharing normal form and that all their free varibales are caputerd by closures. This property is preserved by reduction and it is natural in the context of sharing calculus. In particular all the useful computation strategies satisfy it, including the one reproducing fully lazy sharing.

%For simplifying the presentation, we consider in the remainder of this paper, that terms of multiplicity $n$ are of the form $\langle t^1,\dots, t^n \rangle\G$ with $t$ unfolded. This means in particular that we do not compute inside $\tup*\cdot$. This restriction is natural in the context of sharing calculus and all the useful computation strategies satisfy it, in particular the one reproducing fully lazy sharing.


\begin{ALdefinition}
The \emph{value} $|A|$ of a formula $A$ is defined inductively by:
\[
\begin{array}{lll}
|X| & = & \mathcal{N}
\\
%|A\cap B| & = & |A| \cap |B|
%\\
|A\vlim B| & = & \mbox{\{$u$ \;|\;  $u$ is a term and, for each term $v\in |A|$, $(u)v \in |B|$ \}}
\end{array}
\]
Values are extended to conjunctive formulae by the following clauses, for $n>0$:
\[
\begin{array}{lll}
|A_1\vlan\dots\vlan A_n| & = & \mbox{\{$t^n$ \;|\; for each $i\leq n$, $\pi_i(t) \in |A_i|$\}}
\\
|\top| & = & \mbox{\{$\tup*{}\G$ \;|\; for any $x\in\Var$, $x\G\in\SN$\}}
\end{array}
\]
\end{ALdefinition}
%
%
Values of formulae are called {\em reducibility sets}. 
%
Note that if $t\in|A|$ and $t'$ is a variant of $t$, then $t'\in|A|$.


\begin{ALproposition}\label{prop:IntBase}
For each formula $A$, $\VAR \subseteq |A| \subseteq  \SN$
\end{ALproposition}

\begin{ALproposition}
 For any formulae $A_1,\dots,A_n$, $|A_1\vlan\dots\vlan A_n| \subseteq \SN$.
\end{ALproposition}

\begin{ALlemma}\label{lem:RedStab}
For any formula $A$,  if $u\in |A|$ and $u \rightsquigarrow v$, then $v \in |A|$ .
\end{ALlemma}

\begin{proof}
 Immediate by induction on $A$.
\end{proof}

\begin{ALlemma}\label{lem:Red-AddSharings}
For any formula $B$,  if $(u)\overline{w}\in |B|$ then $(u\share*{\vv*x}y)\overline{w} \in |B|$.
\end{ALlemma}

\begin{ALlemma}\label{lem:IntCaseLambdaSharing}
\begin{compactenum}[\upshape(i)]
%
\item If $(u\{v/x\})\overline{w} \in |B|$ and $v\in\SN$, then $((\lambda x.u) v)\overline{w} \in |B|$.
%
\item If $(u\subn{x_i}{\sn(t)^i}[\sh (t)])\overline{w} \in |B|$ and $t\in\SN$, 
	\\ then $(u[x_1,\dots,x_n \leftarrow t])\overline{w} \in |B|$.
%
\item If $(u\subn{x_i}{\sn(\lambda y.\pi_i(t))^i}[\sh (\lambda y.t)])\overline{w} \in |B|$ and $t\in\SN$,
	\\ then $(u[x_1,\dots,x_n \twoheadleftarrow \lambda y.t])\overline{w} \in |B|$.
%
\end{compactenum}
%
\end{ALlemma}

\begin{proof}
Statement (i) follows from Lemma~\ref{lem:IntCaseLambda0} (the full proof can be found in the Appendix); (ii) is proved below by induction on $B$; the proof of (iii) is similar.
%
\\
1) $B$ is a variable. Then $|B| = \SN$ and the result is given by Lemma~\ref{lem:IntCaseSharing0}.
\\
2) $B= C\vlim D$.
%
Let $u'=(u\subn{x_i}{\sn(t)^i}[\sh (t)])\overline{w} \in |C\vlim D|$ and $t\in\SN$.
%
Let $v\in|C|$.
%
We prove that $((u\share xt)\overline{w})v \in |D|$.
%
By the definition of $|C\vlim D|$ we have $(u')v\in|D|$.
%
By the induction hypothesis $((u[x_1,\dots,x_n \leftarrow t])\overline{w})v \in |D|$.
%
It follows that $(u[x_1,\dots,x_n \leftarrow t])\overline{w} \in |C\vlim D|$.
%\\
%3) $B= C\cap B$.
%The result directly follows from the induction hypothesis using the fact that $|C\cap D| = |C|\cap|D|$.

\end{proof}

\begin{ALproposition}\label{prop:IntSubst}
%If $x_1:A_1,\ldots, x_n:A_n \vdash_S u:B$ and $v_1 \in |A_1|, \dots, v_n \in |A_n|$, then $u\{v_1/x_1, \dots, v_n/x_n\} \in |B|$.
If $(x_i:A_i)_{i\leq n}\vdash_S u:B$ and $v_i \in |A_i|$, then $u\subn{x_i}{v_i} \in |B|$.

\end{ALproposition}

\begin{proof}
%
We proceed by induction on the derivation of $(x_i:A_i)_{i\leq n}\vdash_S u:B$.
%
\begin{enumerate}
\setlength{\itemsep}{\medskipamount}%
\setlength{\parskip}{0pt}

	\item
The last rule is $\typevar$, with conclusion $x:A\vdash x:A$.
%
For $v\in|A|$ we have $x\{v/x\} = v\in|A|$.


	\item
The last rule is
\[
  \vliiinf{}{\typeapp}
	{(x_i:C_i)_{i\leq n},(y_j:D_j)_{j\leq m}\vdash (t)u : B}
	{(x_i:C_i)_{i\leq n}\vdash t : A\vlim B}
	{}
	{(y_j:D_j)_{j\leq m}\vdash u : A}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq n$ and $j\leq m$.
%
By the induction hypothesis, $t\subn{x_i}{v_i}\in|A\vlim B|$ and $u\subn[m][j]{y_j}{w_j}\in|A|$.
%
By the definition of $|-|$,
%
\[
	((t)u)\subn{x_i}{v_i}\subn[m][j]{y_j}{w_j} = (t\subn{x_i}{v_i})u\subn[m][j]{y_j}{w_j} \in|B|\;.
\]


	\item
The last rule is
\[
  \vlinf{}{\typeabs}
	{(x_i:C_i)_{i\leq n} \vdash \lambda x.t : A \vlim B}
	{(x_i:C_i)_{i\leq n}, x : A \vdash t : B}
\]
Let $v_i \in |C_i|$ for $i\leq n$, and suppose $w\in |A|$. 
%
By the induction hypothesis we have $t\subn{x_i}{v_i}\sub xw\in|B|$. 
%
By Lemma~\ref{lem:IntCaseLambdaSharing}, $(\lambda x.t\subn{x_i}{v_i})w \in |B|$.
%
It follows that 
\[
	(\lambda x.t)\subn{x_i}{v_i} = \lambda x.t\subn{x_i}{v_i}\in | A\vlim B|\;.
\]


	\item
The last rule is
\[
  \vliiinf{}{\typeshare}
	{(y_i:C_i)_{i\leq k}, (z_i:D_i)_{i\leq m} \vdash u\share xt : A}
	{(y_i:C_i)_{i\leq k}, (x_i:B)_{i\leq n} \vdash u : A}
	{}
	{(z_i:D_i)_{i\leq m} \vdash t : B}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq k$ and $j\leq m$, and let $u'= u\subn[k]{y_i}{v_i}$ and $t'=t\subn[m][j]{z_j}{w_j}$.
% 
We have to prove that the following term is in $|A|$:
\[
	(u\share xt)\subn[k]{y_i}{v_i}\subn[m][j]{z_j}{w_j}= u'\share x{t'}\;.
\]
By the induction hypothesis, $t'\in|B|$; then also the unfolded body $\sn(t')$ is in $|B|$.
%
Let $\sn(t')^1,\dotsc,\sn (t')^n$ be fresh variants.
%
Therefore by the induction hypothesis,
$
	u'\subn{x_i}{\sn(t')^i}\in|A|
$,
and by Lemma~\ref{lem:Red-AddSharings}, $u'\subn{x_i}{\sn(t')^i}[\sh(t')]$ is in $|A|$.
%
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $u'\share x{t'}\in |A|$.


	\item
The last rule is
\[
\hspace{-\leftmargin}
  \vliiinf{}{\typedist}
	{(y_i:C_i)_{i\leq k}, (z_i:D_i)_{i\leq m} \vdash s\distr xy{u^n} : C}
	{(y_i:C_i)_{i\leq k}, (x_i:A \vlim B)_{i\leq n} \vdash s : C}
	{\hspace{-6pt}}
	{(z_i:D_i)_{i\leq m}, y : A \vdash u^n : B\vlan\cdots\vlan B}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq k$ and $j\leq m$, and let $s'=s\subn[k]{y_i}{v_i}$ and $u'=u^n\subn[m][j]{z_j}{w_j}$.
%
We have to prove that the following term is in $|C|$:
\[
	(s\distr xy{u^n})\subn[k]{y_i}{v_i}\subn[m][j]{z_j}{w_j}=s'\distr xy{u'}\;.
\]
%
% The $n$-term $u^n$ is of the form $\tup*{t^1,\dotsc, t^n}\G$ with each $t^i$ a fresh variant of an unfolded term $t$.
%
% Let $t'=t\G\subn[m][j]{z_j}{w_j}$.
%
By the induction hypothesis,
$
	u^n\subn[m][j]{z_j}{w_j}\sub{y}{r} \in|B\vlan\cdots\vlan B|
$
for each $r\in |A|$,
%
and therefore $\pi_i(u'\sub yr)=\pi_i(u')\sub yr\in|B|$.
%
Then, for each $r\in |A|$, $(\lambda y.\pi_i(u'))r \in|B|$ by Lemma~\ref{lem:IntCaseLambdaSharing}, and by definition of $|-|$, $\lambda y.\pi_i(u')\in|A\vlim B|$.
%
By Lemma~\ref{lem:RedStab} also the unfolding of $\lambda y.\pi_i(u')$ belongs to $|A \vlim B|$, as does any variant $\sn(\lambda y.\pi_i(u'))^i$.
%
By the induction hypothesis, $s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}$ is in $|C|$, and by Lemma~\ref{lem:Red-AddSharings},
$
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}[\sh(\lambda y.u^n)]\in|C|.
$
%
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $s'\distr xy{u'}\in|C|$.
%
\end{enumerate}


\end{proof}

\begin{ALtheorem}\label{thm:SN}
%If $x_1:A_1,\dots, x_n:A_n \vdash_S u:B$ then $u \in \SN$.
If $(x_i:A_i)_{i\leq n} \vdash_S u:B$ then $u \in \SN$.
\end{ALtheorem}



\begin{proof}
%
Suppose $(x_i:A_i)_{i\leq n} \vdash_S u:B$.
%
By Proposition~\ref{prop:IntBase}, we have $x_i\in |A_i|$ for $i\leq n$.
%
Therefore by Proposition~\ref{prop:IntSubst},  $u\subn{x_i}{x_i}\in |B|$, i.e.\ $u \in |B|$, and by Proposition~\ref{prop:IntBase} we have $u \in \SN$.

\end{proof}


% =================================================================================================
\section{Closure properties of Strongly Normalisable Atomic Lambda Terms}
\label{sec:ClosPropSN}


In this section we prove closure properties for the set of strongly normalisable atomic lambda terms
which are used in Section~\ref{sec:SNproof}.

We denote by $\VAR$ the set of variables.

\begin{ALlemma}\label{lem:HeadVar}
If $x\in \VAR$ and $\overline{t} \in \SN^{<\omega}$, then
$(x)\overline{t} \in \SN$.
\end{ALlemma}

The following Lemma~\ref{lem:IntCaseLambda0} is a generalisation of the fact that if $(u\sub xv)\overline w \in \SN$, then $(\lambda x.u)v)\overline{w} \in \SN$, which is used in Lemma~\ref{lem:IntCaseLambdaSharing}.

For each term $u \in \SN$, we denote $S(u)$ the sum of the lengths of the reduction sequences of $u$ leading to a normal form. The length $lh(t)$ of a term $t$ is defined in the usual way, except that in a distributor, the length of its body $\lambda y.\tup t\G$ is defined as the max of the length of each $t_i\G$.
We denote by $\overline{w\G}$ a (possibly empty) sequence $w_1[\Gamma_1]\dots w_n[\Gamma_n]$, where $w_1,\dots ,w_n$ are terms (we suppose that a non-empty sequence  $\overline{w\G}$ has at least one term $w_1$).
By $(u)\overline{w\G}$, we mean $((...(((u)w_1)[\Gamma_1])\dots )w_n)[\Gamma_n]$; thus, each $\G[i]$ may bind not only in $w_i$, but also in $u$, and in all $\G[j]$ and $w_j$ for $j<i$.

\begin{ALlemma}\label{lem:IntCaseLambda0}
If $((u\sub xv)\G\G')\overline{w\G} \in \SN$, then $((((\lambda x.u)\G) v)\G')\overline{w\G} \in \SN$.
\end{ALlemma}

\begin{proof}
Let $T = ((((\lambda x.u)\G) v)\G')\overline{w\G}$ and $T' = ((u\sub xv)\G\G')\overline{w\G}$.
%
To show that $T\in\SN$, it must be shown that each one-step reduction from $T$ gives a term $U\in\SN$.
%
This can be shown by induction on $Mes(T) = (S(T'), lh(u), lh(v), \lh\G)$ where $\lh\G$ is the length of the sequence $\G$.
\end{proof}

\newcommand{\term}{{\mathsf{t}}}

To each closure $\g$, we associate its \emph{term} $t(\gamma)$ and its \emph{computation} $\g^v$, defined as follows:
\begin{itemize}

	\item
If $\g = \share xt$, then $t(\gamma) = t$ and $\g^v = \subn{x_i}{\sn(t)^i}[\sh (t)]$

	\item
If $\g = \distr xy{t^n}$, then  $t(\gamma) = \lambda y.t^n$\\ and $\g^v = \subn{x_i}{\sn(\lambda y.\pi_i(t^n))^i}[\sh (\lambda y.t^n)]$.
\end{itemize}

The following Lemma~\ref{lem:IntCaseSharing0} is a generalisation of the fact that if $(u\g^v)\overline w \in \SN$, then $(u\g)\overline{w} \in \SN$, which is used in Lemma~\ref{lem:IntCaseLambdaSharing}.

\begin{ALlemma}\label{lem:CompSubst}
 $\g^v\sub xw \rightsquigarrow [\gamma\sub xw]^v$
\end{ALlemma}

\begin{proof}
Immediate by definition.
\end{proof}

For $\G = \g[1]\dots\g[p]$, we denote by $\G^*$ the sequence $\g[1]^* \dots\g[p]^*$, where $\g[i]^*$ is either $\g[i]$ or $\g[i]^v$.


\begin{ALlemma}\label{lem:IntCaseSharing0}
 If $(u\G[0]^*)\overline{w\G^*} \in \SN$ and for each closure $\g$ of $\G[0]\overline{\G}$,  $\term (\gamma)\in\SN$, then $(u\G[0])\overline{w\G} \in \SN$.
\end{ALlemma}

\begin{proof}

  Let $T = (u\G[0])\overline{w\G}$ and $T' = (u\G[0]^*)\overline{w\G^*}$.
\\
We proceed by induction on $Mes(T,T') = (S(T'), m_1(T), m_2(T))$ where

 $m_1(T)$ is the sum of the $S(t(\gamma))$ for  $\g$ in $\G[0]\overline{\G}$

 $m_2(T)$ is the sum of the $lh(t(\gamma))$ for $\g$ in $\G[0]\overline{\G}$
 \\
If,  for each closure $\g$ of $\G[0]\overline{\G}$,  $\g^* = \g$, then the result is trivial (note that if $t(\gamma)$ is a variable, then  $\g^* = \g$). We suppose in the following that $\g^* \neq \g$ for at least one$\g$ of $\G[0]\overline{\G}$ . We can also suppose that $u$ doesn't end with a closure, because it can be integrated in the sequence $\G[0]$.


In order to show that $T\in\SN$, we show that each one-step reduction from $T$ gives a term $U\in\SN$. We consider the different possible reductions leading to $U$. If the reductions are inside $u$ or $\overline{w}$ we conclude as in Lemma~\ref{lem:IntCaseLambda0}. If it is the lifting of a closure $\g$ of $\G[0]\overline{\G}$ using rule (2) we conclude also as in Lemma~\ref{lem:IntCaseLambda0}. It remains to consider the different possible reductions in a closure $\g$ of $\G[0]\overline{\G}$ or the interaction of two such closures using rule (9). For simplification we consider the case where the reduction involves $\g[1]$.
%
%
\medskip
\\
1) Suppose that $U$ is obtained by the reduction a closure $\g$ such that  $\g^* = \g$. Suppose for instance that is closure $\g[i]$ of $\G[0] = \g[1] \dots\g[p]$. This reduction  may apply substitutions to $u$ and $\gamma_j$, for $j<i$, transforming them into $u^S$ and $\gamma_j^S$. We have in this case $U = (u^S\g[1]^S \dots [\gamma'_i]\dots \g[p])\overline{w\G}$.
\\
Consider $U' = (u^S\g[1]^{S*} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*}$ (note that that by $\g[1]^{S*}$ we mean that we apply first the substitution and then computation, and by $\g[1]^{*S}$, the converse).  We have:\quad
$
\begin{array}[t]{llll}
 T' & = & (u\g[1]^* \dots\g[p]^*)\overline{w\G^*} & \\
    & \rightsquigarrow^1 & (u^S\g[1]^{*S} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*} & \\
    & \rightsquigarrow & (u^S\g[1]^{S*} \dots [\gamma'_i]\dots \g[p]^*)\overline{w\G^*} & \hspace{0.5cm} \mbox{by Lemma~\ref{lem:CompSubst}  }\\
    & = & U' &
\end{array}
$
\\
Therefore $U'\in\SN$ and $S(U')<S(T')$. Because $Mes(U,U') < Mes(T,T')$, we have by the induction hypothesis, $U\in\SN$.
%
%
\medskip
\\
2) Suppose that $U$ is obtained by the reduction of a closure $\g$ such that $\g^* = \g^v$.
%
For simplicity let $\g=\g[1]$, the first closure of $\G[0]$, and $\G[0] = \g[1]\G'[0]$.
\smallskip
\\
2.1)  $T = (u\share xt\G'[0])\overline{w\G}$ and $U = (u\share x{t'}\G'[0])\overline{w\G}$ with $t\rightsquigarrow^1 t'$.
%
In this case $T' = (u\subn{x_i}{\sn(t)^i}[\sh (t)]\G'[0]^*)\overline{w\G^*}$.
%
Consider $U' = (u\subn{x_i}{\sn(t')^i}[\sh (t')]\G'[0]^*)\overline{w\G^*}$. We have $\sh (t') = \sh (t)$ and by Lemma~\ref{lem:lift-sn}, $\sn (t) \rightsquigarrow \sn (t')$. Therefore $T'\rightsquigarrow U'$ and $U'\in\SN$. We have also $S(U')\leq S(T')$ and $S(t')<S(t)$. It follows that  $m_1(U) < m_1(T)$ and  $Mes(U,U') < Mes(T,T')$ and we have by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.2)
$T =  (u\distr xyt\G'[0])\overline{w\G}$ and
$U =  (u\distr xy{t'}\G'[0])\overline{w\G}$, with $t ~\rewrite^1~ t'$.
In this case
$T' = (u\subn{x_i}{\sn(\lambda y.\pi_i(t))^i}[\sh(\lambda y.t)]\G'[0]^*)\overline{w\G^*}$.
Consider
$U' = (u\subn{x_i}{\sn(\lambda y.\pi_i(t'))^i}[\sh(\lambda y.t')]\G'[0]^*)\overline{w\G^*}$.
Since $[\sh(\lambda y.t)]=[\sh(\lambda y.t')]$, by Lemma \ref{lem:lift-sn}
$\sn(\lambda y.\pi_1(t)) \rewrite^\star \sn(\lambda y.\pi_1(t'))$.
Therefore $T'\rewrite U'$ and $U'\in\SN$. We have also that
$S(U')\leq S(T')$ and $S(t') < S(t)$. It follows that $m_1(U)<m_1(T)$
and $Mes(U,U') < Mes(T,T')$ and we have by the induction hypothesis,
$U\in\SN$.
%
% 2.2)  $T = (u[x_1,\dots,x_n \leftarrow (t)v]\G'[0])\overline{w\G}$ and
% \\
% $U = (u\{(\alpha_1)\beta_1 /x_1,\dots, (\alpha_n)\beta_n/x_n\}[\alpha_1,\dots,\alpha_n \leftarrow t][\beta_1,\dots,\beta_n \leftarrow v]\G'[0])\overline{w\G}$.
% \\
% In this case $T' = (u\{\sn((t)v)^1/x_1,\dots,\sn((t)v)^n/x_n\}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$.
% \\
% Consider $U' = (u\{(\alpha_1)\beta_1 /x_1,\dots, (\alpha_n)\beta_n/x_n\}
% \{\sn(t)^1/\alpha_1,\dots,\sn(t)^n/\alpha_n\}[\sh(t)]\{\sn(v)^1/\beta_1,\dots,\sn(v)^n/\beta_n \leftarrow v\}[\sh(v)]\G'[0]^*)\overline{w\G^*}$.
% \\
% We have
% \begin{eqnarray*}
%  U' & = & (u \{(\sn (t)^1)\sn (v)^1 /x_1,\dots, (\sn (t)^n)\sn(t)^n/x_n\}[\sh(t)][\sh(v)]\G'[0]^*)\overline{w\G^*}\\
%     & = & (u\{\sn((t)v)^1/x_1,\dots,\sn((t)v)^n/x_n\}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*} \\
%     & = & T'
% \end{eqnarray*}
% Therefore $U'\in\SN$ and $S(U') = S(T')$. We also have  $m_1(U) \leq m_1(T)$ and because $lh(t) + lh(v) < lh((t)v)$, $m_2(U) < m_2(T)$ and  $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.3)  $T = (u\share x{(t)v}\G'[0])\overline{w\G}$ and
\\
$U = (u\subn{x_i}{(\alpha_i)\beta_i}\share\alpha t\share\beta v\G'[0])\overline{w\G}$.
%
In this case $T' = (u\subn{x_i}{\sn((t)v)^i}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u	\subn{x_i}{(\alpha_i)\beta_i}
			\subn{\alpha_i}{\sn(t)^i}[\sh(t)]
			\subn{\beta_i}{\sn(v)^i}[\sh(v)]
			\G'[0]^*
		  )\overline{w\G^*}
\]
We have:\quad
\begin{tabular}[t]{rclcl}
 $U'$ & $=$ & $(u\subn{x_i}{(\sn (t)^i)\sn (v)^i}[\sh(t)][\sh(v)]\G'[0]^*)\overline{w\G^*}$
\\    & $=$ & $(u\subn{x_i}{\sn((t)v)^i}[\sh ((t)v)]\G'[0]^*)\overline{w\G^*}$
      & $=$ & $T'$\;.
\end{tabular}\\
Therefore $U'\in\SN$ and $S(U') = S(T')$. Since $lh(t) + lh(v) < lh((t)v)$, it follows that $m_2(U) < m_2(T)$, and since we also have $m_1(U) \leq m_1(T)$, we have $Mes(U,U') < Mes(T,T')$. Then by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.4)  $T = (u\share x{\lambda y.t}\G'[0])\overline{w\G}$ and
\\
$U = (u\distr xy{\tup\alpha\share\alpha t}\G'[0])\overline{w\G}$.
%
In this case $T' = (u\subn{x_i}{\sn(\lambda y.t)^i}[\sh(\lambda y.t)]\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u\subn{x_i}{\sn(\lambda y.\alpha\share*\alpha t)^i}[\sh(\lambda y.\alpha[\alpha \leftarrow t])]\G'[0]^*)\overline{w\G^*}
\]
%
% NOTE: I made the $\lambda y.\alpha\share*\alpha t$ into variants 
%
We have  $U' = (u\subn{x_i}{\sn(\lambda y.t)^i}[\sh (\lambda y.t)]\G'[0]^*)\overline{w\G^*} = T'$.
%\EMPTY{(check this equality)}
%
Therefore $U'\in\SN$ and $S(U') = S(T')$. We also have $m_1(U) \leq m_1(T)$, and $m_2(U) < m_2(T)$ because $\lh(\lambda y.\tup\alpha\share\alpha t) = \lh(t) < \lh(\lambda y.t)$, which gives us $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
\smallskip
\\
2.5)  $T = (u\distr xy{\tup t\share*{\vv{\vv*z}}y}\G'[0])\overline{w\G}$ and
\\
$U = (u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}\G'[0])\overline{w\G}$.
%
In this case we have $T' = ( u\subn{x_i}{\sn(\lambda y_i.t_i\share*{\vv*z_i}y_i)}\G'[0]^*)\overline{w\G^*}$.
%
Consider 
\[
	U' = (u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}\G'[0]^*)\overline{w\G^*}
\]
%
Because $t_i$ is already in sharing normal form, we have $\sn(\lambda y_i.t_i\share*{\vv*z_i}y_i) = \lambda y_i.t_i\share*{\vv*z_i}{y_i}$.
%
It follows that $T' = U'$, $U'\in\SN$ and $S(U') = S(T')$.
%
Since $m_1(U) < m_1(T)$ it follows that $Mes(U,U') < Mes(T,T')$. Thus by the induction hypothesis, $U\in\SN$.
%
%
%
%
\medskip
\\
3)  Suppose that U is obtained by the interaction of the two first closures of $\G[0]$ using rule (9). It is enough to consider only the non-trivial case where the term of the second closure is not a variable. We have
%
\begin{align*}
	T &= (u[y_1,\dots,y_m  \leftarrow x_1][x_1,x_2\dots,x_n \leftarrow t]\G'[0])\overline{w\G} \\
	U &= (u[y_1,\dots,y_m,x_2\dots,x_n \leftarrow t]\G'[0])\overline{w\G}\;.
\end{align*}
%
Let $\vv[p]z$ be the free variables of $t$. By our renaming convention, the free variables of $\sn(t)^i$ are $\vv[p]{z^i}$. In the following we will have to consider $\sn (\sn (t)^1)^j$. Because $\sn(t)$ is unfolded, $\sn(\sn(t)) = \sn(t)$ and $\sn (\sn (t)^1)^j$ is obtained from $\sn(t)$ by replacing any variable $x$ by $(x^1)^j$: we will  adopt the notation $x^{1,j}$ for $(x^1)^j$ and $\sn(t)^{1,j}$ for $\sn (\sn (t)^1)^j$.
%
We have
%
\begin{eqnarray*}
 T' & = & (u\share[m]y{x_1}\subn{x_i}{\sn(t)^i}[\sh(t):1,\dotsc,n]\G^*)\overline{w\G^*} \\
    & = & (u\share[m]y{\sn(t)^1}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}[\sh(t):1,\dotsc,n]\G^*)\overline{w\G^*} \\
    & \rightsquigarrow 
    	& (u\subn[m][j]{y_j}{\sn(t)^{1,j}}[\sh (t^1):(1,1),\dotsc,(1,m)] \\
    &   & \quads4 \sub{x_i}{\sn(t)^i}_{2\leq i\leq n}[\sh (t):1,\dots,n]\G^*)\overline{w\G^*} \\
    & = & (u\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n} \\
    &   & \quads4 [\sh (t^1):(1,1),\dots,(1,m)][\sh (t):1,\dots,n]\G^*)\overline{w\G^*}
\end{eqnarray*}
%
Let $u' = u\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}$.
%
We have
%
\[
\begin{array}{rc@{}l@{}}
	\multicolumn{3}{@{}l@{}}{
		u'[\sh (t^1:(1,1),\dots,(1,m))][\sh (t:1,\dots,n)]
		%\makebox[\textwidth][l]{$u_1[\sh (t^1:(1,1),\dots,(1,m))][\sh (t:1,\dots,n)]$}}
	}
\\[4pt]
	&=&	u'	\share*{z_i^{1,1},\dotsc, z_i^{1,m}}{z_i^1}_{i\leq p}
			\share*{\vv^{z_i}}{z_i}_{i\leq p}
\\[4pt]
	&{}\rightsquigarrow{}&
		u'	\share*{z_i^{1,1},\dotsc, z_i^{1,m}, z_i^2,\dots,z_i^n}{z_i}_{i\leq p}
\\[4pt]
	&=&	u'[\sh (t):(1,1),\dotsc,(1,m),2,\dotsc,n]\;.
\end{array}
\]
%
Consider 
$
	U' = (u'%\subn[m][j]{y_j}{\sn(t)^{1,j}}\sub{x_i}{\sn(t)^i}_{2\leq i\leq n}
		 [\sh (t):(1,1),\dots,(1,m),2,\dots,n]\G^*)\overline{w\G^*}
$.
We have $T'\rightsquigarrow U'$ and therefore $U'\in\SN$; because $t$ is not a variable, $S(U')<S(T')$.
%\TODO{check in the limit cases (eg nullary sharings) that there is always one step of reduction}
Because $Mes(U,U') < Mes(T,T')$, we have by the induction hypothesis, $U\in\SN$.


\end{proof}






% 
% =================================================================================================
\section{Conclusions and further work}



The present result, of strong normalisation for the atomic lambda-calculus with intersection types, emphasises how the calculus is a natural and well-behaved formalisation of sharing in the lambda-calculus.
%
Future investigations will expand in three directions: strengthening the current strong normalisation result; adapting the atomic lambda-calculus to address further notions of sharing; and investigating the practical use of the calculus in computation, for instance in compiling or implementing functional programming languages.



The present work strongly suggests an angle for future research: it is expected that the type system and strong normalisation proof can be extended to the second-order case---although subject reduction is not immediately obvious.% in this case.%, where type inference (in e.g.\ a  Hindley--Milner type system) becomes useful


For the atomic lambda-calculus in general, further work will focus on variations on the calculus that more closely approach the reduction dynamics of sharing graphs, to encompass further degrees of sharing.
%
Another direction would be the inclusion of general recursion in the calculus, and the investigation of its interaction with the sharing constructs, as a prerequisite of making the calculus useful in practice to the implementation of functional programming languages.



\bibliographystyle{plain}
\bibliography{AL-LPAR}

\newpage

\include{appendix}






\end{document}






% =================================================================================================
\section{Strong Normalisation for Intersection Types}
\label{sec:SND}

In this section we outline how the above result can be extended from simple types to intersection types. The typing system $D_a$ is obtained from $S_a$ by adding the typing rules:

\noindent\textbf{Typing rules for $D_a$:}
\[
	\vliinf{}{}
	  {\Gamma \vdash u: A\cap B}
	  {\Gamma \vdash u: A}
	  {\Gamma \vdash u: B}
	\qquad
	\vlinf{}{}
	  {\Gamma \vdash u: A}
	  {\Gamma \vdash u: A\cap B}
	\qquad
	\vlinf{}{}
	  {\Gamma \vdash u: B}
	  {\Gamma \vdash u: A\cap B}
\]
\[
	\vliiinf{}{}
	  {\Gamma,\Delta \vdash u^*\distr xy{t^n}:A}
	  {\Gamma, (x_i:\bigcap_{j\leq m}(B_j\vlim C^i_j))_{i\leq n} \vdash u^*:A}
	  {}
	  {(\Delta, y:V_j\vdash t^n : \vls(C_j^1.\dots.C_j^n))_{j\leq m}}
\]
Where in the last rule, $V_j$ may be any type if $y$ occurs \emph{weakened}, as defined below, and $V_j=B_j$ otherwise.

\begin{ALdefinition}
A variable $y$ occurs \emph{weakened} in a term $t$ if $t$ has a subterm $v\share xu$ such that $y\in\FV(u)$ and each $x_i$ occurs weakened in $v$.
\end{ALdefinition}


\begin{ALlemma}
\label{lem:unfolding weakened variable}
If a variable $y$ occurs free and weakened in a term $t$ then the unfolding of $t$ is of the form $t'\share*{}y$.
\end{ALlemma}

\begin{ALlemma}
\label{lem:weakening SN}
If $(t)\overline w\in\SN$, then $\forall v\in\SN.~(t\share*{}v)\overline w\in\SN$.
\end{ALlemma}

\begin{ALlemma}
\label{lem:weakening RED}
If $(t)\overline w\in|B|$, then $\forall v\in\SN.~(t\share*{}v)\overline w\in|B|$.
\end{ALlemma}

\begin{proof}
The proof is by induction on $B$.
%
The case where $B$ is an atom is covered by Lemma~\ref{lem:weakening SN}; the case $B=C\cap D$ is immediate.
%
For $B=C\vlim D$, let $v\in\SN$. 
%
We have to show that $(t\share*{}v)\overline w\in|C\vlim D|$, i.e.\ that $(t\share*{}v)\overline ww\in |D|$ for all $w\in|C|$.
%
Let $w\in|C|$.
%
Because $(t)\overline w\in|C\vlim D|$, we have $(t)\overline ww\in|D|$, and by the induction hypothesis, $(t\share*{}v)\overline ww\in|D|$.
\end{proof}


Furthermore, the notion of reducibility set is extended to intersection types by $|A\cap B|=|A|\cap|B|$. The following theorem can then be proven by generalising the results in Section~\ref{sec:SNproof}.


\begin{ALproposition}\label{prop:IntSubstIntersection}
If $(x_i:A_i)_{i\leq n}\vdash_D u:B$ and $v_i \in |A_i|$, then $u\subn{x_i}{v_i} \in |B|$.
\end{ALproposition}

\begin{proof}
%
We proceed by induction on the derivation of $(x_i:A_i)_{i\leq n}\vdash_D u:B$.

We only show the first intersection rule, the three others are immediate and the other cases are as in the proof of Proposition~\ref{prop:IntSubst}.

The last rule is
\[
\hspace{-\leftmargin}
  \vliiinf{}{\typedist}
	{(y_i:C_i)_{i\leq k}, (z_i:D_i)_{i\leq m} \vdash s\distr xy{u^n} : C}
	{(y_i:C_i)_{i\leq k}, (x_i:\bigcap_{j\leq m}(A_j \vlim B_j))_{i\leq n} \vdash s : C}
	{\hspace{-6pt}}
	{((z_i:D_i)_{i\leq m}, y : A_j \vdash u^n : B_j\vlan\cdots\vlan B_j)_{j\leq m}}
\]
Let $v_i\in|C_i|$ and $w_j\in|D_j|$ for $i\leq k$ and $j\leq m$, and let $s'=s\subn[k]{y_i}{v_i}$ and $u'=u^n\subn[m][j]{z_j}{w_j}$.
%
We have to prove that the following term is in $|C|$:
\[
	(s\distr xy{u^n})\subn[k]{y_i}{v_i}\subn[m][j]{z_j}{w_j}=s'\distr xy{u'}\;.
\]

We distinguish two cases, depending on whether $y$ occurs weakened.

\medskip

\noindent\textbf{(i)}
%
The variable $y$ occurs weakened.
%
In this case, $V_j=A_j$.
%
By the induction hypothesis, for each $r\in |A|$ and $j\leq m$
\[
	u^n\subn[m][j]{z_j}{w_j}\sub{y}{r} \in|B_j\vlan\cdots\vlan B_j|
\]
and therefore $\pi_i(u'\sub yr)=\pi_i(u')\sub yr\in|B_j|$.
%
Then, for each $r\in |A|$ and $j\leq m$, $(\lambda y.\pi_i(u'))r \in|B_j|$ by Lemma~\ref{lem:IntCaseLambdaSharing}, and by definition of $|-|$, $\lambda y.\pi_i(u')\in|A_j\vlim B_j|$. Again by definition of $|-|$, $\lambda y.\pi_i(u')\in|\bigcap_{j\leq m}(A_j \vlim B_j)|$.
%
By Lemma~\ref{lem:RedStab} also the unfolding of $\lambda y.\pi_i(u')$ belongs to $|\bigcap_{j\leq m}(A_j \vlim B_j)|$, as does any variant $\sn(\lambda y.\pi_i(u'))^i$.
%
By the induction hypothesis, $s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}\in|C|$, and by Lemma~\ref{lem:Red-AddSharings},
\[
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}[\sh(\lambda y.u^n)]\in|C|\;.
\]
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $s'\distr xy{u'}\in|C|$.
%

\medskip

\noindent\textbf{(ii)}
%
The variable $y$ occurs weakened.
%
By the induction hypothesis, for each $j\leq m$
\[
	u'=u^n\subn[m][j]{z_j}{w_j}\in|B_j\vlan\dotso\vlan B_j|\;,
\]
and therefore $\pi_i(u')\in|B_j|$, and $\sn(\pi_i(u'))\in|B_j|$.
%
Because $y$ is weakened, we have $\sn(\lambda y.\pi_i(u'))=\lambda y.u''\share*{}y$ with $u''=\sn(\pi_i(u'))$.
%
Since $u''\in|B_j|$, by Lemma~\ref{lem:weakening RED} we have $u''\share*{}v\in|B_j|$ for any $v\in\SN$.
%
Therefore $\lambda y.u''\share*{}y\in|V\vlim B_j|$ for any formula $V$, and in particular $\lambda y.u''\share*{}y\in|A_j\to B_j|$.
%
This means that $\sn(\lambda y.\pi_i(u'))$ is in $|\bigcap_{j\leq n}(A_j\vlim B_j)|$, as is any variant of it.
%
By the induction hypothesis, 
\[
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}\in|C|
\]
and by Lemma~\ref{lem:Red-AddSharings}
\[
	s'\subn{x_i}{\sn(\lambda y.\pi_i(u'))^i}[\sh(\lambda y.u^n)]\in|C|\;.
\]
It follows by Lemma~\ref{lem:IntCaseLambdaSharing} that $s'\distr xy{u'}\in|C|$.
%
\end{proof}

\begin{ALtheorem}\label{thm:SND}
If $x_1:A_1,\dots, x_n:A_n \vdash_D u:B$ then $u \in \SN$.
\end{ALtheorem}

\noindent
As a consequence of this theorem we get the preservation of the strong normalisation with respect to lambda-calculus (often called PSN property), using the well know fact that the strongly normalisable lambda-terms are typable in $D$ (\cite{Coppo-DezaniCiancaglini-1980,Pottinger-1980,Krivine-1993}).

\begin{ALtheorem}[PSN]
If $N$ is strongly normalisable then $\tercoden N$ is strongly normalisable.
\end{ALtheorem}

\begin{proof}
If $N$ is strongly normalisable, then it is typeable in $D$; then by a generalization of Proposition~\ref{prop:types preserved}, $\tercoden N$ is typeable in $D_a$, and by Theorem~\ref{thm:SND}, $\tercoden N$ is strongly normalisable.
\end{proof}



%=================================================================================================
\section{Characterization of Strongly Normalising Atomic Lambda Terms}

\begin{ALproposition}
\label{prop:intersection weakening}
If $\Gamma, x:A\vdash t:B$ then $\Gamma,x:A\cap C\vdash t:B$.
\end{ALproposition}

\begin{ALproposition}
\label{prop:variant typing}
If $t_1$ and $t_2$ are variants of the same term and $x_1:A_1,\dots,x_n:A_n\vdash_D t_1:B$, then $y_1:A_1,\dots,y_n:A_n\vdash_D t_2:B$.
\end{ALproposition}

\begin{ALproposition}
\label{prop:typing substitution}
If $\Gamma,\Delta \vdash_D u\sub xt:A$, then there exists a $B$, such that
$\Gamma, x:B \vdash_D u:A$ and $\Delta\vdash_D t:B$.
\end{ALproposition}

\begin{ALdefinition}
The following rewrite rules are called \emph{unsafe}: \eqref{eqn:beta-reduction}, and \eqref{eqn:share application} for weakenings, %displayed below.
$
	u\share*{}{(t)v}\ALnotbeta u\share*{}t\share*{}v
$.
%
All other rewrite rules are \emph{safe}.
\end{ALdefinition}

Of the two unsafe rules, $\beta$-reduction may cause variables to become weakened.
%
The other rule presents the only case where typing is not preserved by a rule used backward.



%\begin{ALdefinition}
%Let $\ALtype$ be the rewrite system $\rightsquigarrow$ where the rule $u\share x{(t)v}\ALnotbeta u\{(y_i)z_i/x_i\}_{i\leq n}\share yt\share zv$ is restricted to $n\geq 1$.
%\end{ALdefinition}
%
%The aim of this restricted notion of reduction is to be able to reason about reverse preservation of typing:
%
%
%
%
%
%NOTE: we need to make clear that in the below $t$ is the redex itself (rather than the redex being a sub-term).



\begin{ALlemma}
\label{lem:safe reflection}
%
If $t\rewrite u$ by a safe reduction step and $\Gamma \vdash_D u:A$, then $\Gamma \vdash_D t:A$.
%
\end{ALlemma}

\begin{proof}
%
It is assumed $t$ is the redex of $t\rewrite u$; the general case follows by induction on the structure of the terms involved. 
%
Only the two rewrite rules for the distributor are treated here; the remaining cases are relegated to the appendix.

%
\begin{itemize}
%\begin{equation}\tag{$\beta$}\label{eqn:beta-reduction}
%	(\lambda x.u)t ~\ALbeta~ u\sub xt
%\end{equation}
%\item
%Consider rule~(\ref{eqn:beta-reduction}): Given $\Gamma,\Delta \vdash_D u\sub xt:A$, we have by Proposition~\ref{prop:typing substitution}, some $B$ such that
%$\Gamma, x:B \vdash_D u:A$ and $\Delta\vdash_D t:B$, which gives $\Gamma,\Delta\vdash_D (\lambda x.u)t$.
%\label{eqn:sharing above abstraction}

%	\lambda x.t\g & ~\ALnotbeta~ (\lambda x.t)\g
%		 & \text{if}~x\in\FV(t) &&&
%\label{eqn:share abstraction}
%	u\share x{\lambda x.t}~\ALnotbeta~ u\distr xx{\tup y\share yt}

	\item[\eqref{eqn:share abstraction}]
Given $\Gamma,\Delta\vdash_D u\distr*{\vv*x}y{\tup z\share zt}:A$,
%we have $\Delta,y:B_i\vdash\tup z\share zt:C_i\vlan\dotso\vlan C_i$,
%
the typing rule for the distributor gives $\Delta,y:B_i\vdash_D t:C_i$ for each $i\leq n$, and $\Gamma,\vv*x:\bigcap_{i\leq n}(B_i\vlim C_i)\vdash_D u:A$.
%
From this we get $\Gamma,\Delta\vdash_D u\share*{\vv*x}{\lambda y.t}:A$.
%
Note that in case $n=0$, $B$, may be a fake type $B^+$, but this does not affect the argument.

%\label{eqn:distributor elimination}
%	u\distr xy{\tup t\share*{\vv*z}{y}}~\ALnotbeta~
%	u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}

	\item[\eqref{eqn:distributor elimination}]
Given a typing judgement for the reduct,
\[
	\Gamma,\Delta_1,\dots,\Delta_n\vdash_D u\subn{x_i}{\lambda y_i.t_i\share*{\vv*z_i}{y_i}}:A\;,
\]
with each $t_i$ a fresh variant of the same term $t$, by Proposition~\ref{prop:typing substitution} we have formulae $B_i\vlim C_i$ such that
\[
	\Gamma, (x_i:B_i\vlim C_i)_{i\leq n}\vdash_D u:A\;;
\]
and for each $i\leq n$,
\[
	\Delta_i\vdash_D\lambda y_i.t_i\share*{\vv*z_i}{y_i}:B_i\vlim C_i\;.
\]
By Proposition~\ref{prop:intersection weakening} we get
\[
\textstyle
	\Gamma, (x_i:\bigcap_{j\leq n}(B_j\vlim C_j))_{i\leq n}\vdash_D u:A\;.
\]
%
%Let $\Delta_i$ be $d_1^{\kern1pt i}:D_1^{\kern1pt i},\dotsc,d_m^{\kern1pt i}:D_m^{\kern1pt i}$ (since the $t_i$ are variants of $t$, their free variables are variants of the free variables of $t$, taken to be $d_1,\dotsc,d_m$), and let $\Delta'_i$ be obtained from $\Delta_i$ by replacing $d_i^{\kern1pt i}:D_i^{\kern1pt i}$ with $d_i^{\kern1pt i}:D_i^{\kern1pt 1}\vlan\dotso\vlan D_i^{\kern1pt n}$.
%
%%
%For $i\leq n$, let
%\[
%	\Delta'_i =
%		d_  1  ^{\kern1pt i}:D_  1  ^{\kern1pt i},\dotsc,
%		d_{i-1}^{\kern1pt i}:D_{i-1}^{\kern1pt i},
%		d_  i  ^{\kern1pt i}:D_  i  ^{\kern1pt 1}\vlan\dotso\vlan D_i^{\kern1pt n}
%		d_{i+1}^{\kern1pt i}:D_{i+1}^{\kern1pt i},\dotsc,
%		d_  m  ^{\kern1pt i}:D_  m  ^{\kern1pt i}\;.
%\]
%
%, where the $i^{\mbox{th}}$ variable in $\Delta_i'$ is $i^{\mbox{th}}$ variable of $\Delta_i$ with the type being the intersection of each of the types of the $i^{\mbox{th}}$ variable of each of the $\Delta_j$'s. 
%
By Proposition~\ref{prop:variant typing} and~\ref{prop:intersection weakening} we get
$
	\Delta_i,\vv*z_i:B_j\vdash_D t_i:C_j
$
for each $i,j\leq n$.
%
Put together, we get, for each $j\leq n$,
\[
	\Delta_1,\dots,\Delta_n,y:B_j\vdash_D \tup t\share*{\vv*z}{y}:\vls(C_j.\dots.C_j)\;.
\]
We then get
\[
	\Gamma,\Delta_1,\dots,\Delta_n\vdash_D u\distr xy{\tup t\share*{\vv*z}{y}}: A\;.
\]
\end{itemize}
\end{proof}


\begin{ALproposition}
\label{prop:normal form}
If a term is normal, it is of one of the following forms, where $u$ and each $u_i$ are normal.
\[
	x \qquad \lambda x.u \qquad u\share xy \qquad (\dotso(x)u_1\dotso )u_n
\]
\end{ALproposition}

\begin{ALproposition}
\label{prop:typable normal form}
For an atomic lambda-term $t$ in normal form there exist $\Gamma$, $A$ such that $\Gamma\vdash_{D_a} t:A$.
\end{ALproposition}

\begin{proof}
The proof proceeds by induction on $t$, following Proposition~\ref{prop:normal form}.
%
\begin{enumerate}[1)]

	\item
Let $t=x$. Then $x:A\vdash x:A$ for any $A$.

	\item
Let $t=\lambda x.u$ with $u$ normal.
%
By the induction hypothesis there are $\Gamma$, $A$, and $B$ such that $\Gamma, x:A\vdash u:B$.
%
Then $\Gamma\vdash\lambda x.u:A\vlim B$.

	\item
let $t=u\share xy$ with $u$ normal.
%
By the induction hypothesis there are $\Gamma$, $A$, and $B_i$ for $i\leq n$ such that $\Gamma,(x_i:B_i)_{i\leq n}\vdash u:A$.
%
Let $B=\bigcap_{i\leq n}B_i$.
%
By Proposition~\ref{prop:intersection weakening} $\Gamma,(x_i:B)_{i\leq n}\vdash u:A$, and by the inference rule $(\typeshare)$, for sharing, $\Gamma\vdash u\share xy:A$.

	\item
Let $t=(\dotso(x)u_1\dotso )u_n$ with each $u_i$ normal.
%
By the induction hypothesis there are $\Gamma_i$ and $A_i$ for each $i\leq n$ such that $\Gamma_i \vdash u_i: A_i$.
%
For any $B$, the variable $x$ is typed by $x: A_1 \vlim \dotso \vlim A_n \vlim B \vdash x: A_1 \vlim \dotso \vlim A_n \vlim B$.
%
Then $(\Gamma_i)_{i\leq n},x: A_1 \vlim \dotso \vlim A_n \vlim B \vdash (\dotso(x)u_1\dotso )u_n: B$.

\end{enumerate}
\end{proof}

\begin{ALtheorem}
If $u$ is strongly normalising, then it is typeable with intersection types.
\end{ALtheorem}

\begin{proof}
By induction on $S(u)$:
\begin{itemize}
\item
If $S(u)=0$, the result follows by Proposition~\ref{prop:normal form}.
\item
If $u$ is a redex of $\ALtype$, there is a $v$ such that $u\ALtype v$. Then $S(v)<S(u)$ so $v$ is typable by the induction hypothesis and $u$ is typable by Lemma~\ref{lem:reflection}.
\item
If $u=w\share*{}{(t)v}$, both $w,(t)v\in\SN$ and $S(w),S((t)v)<S(u)$, so by the induction hypothesis we have $\Gamma\vdash_D w:A$ and $\Delta\vdash_D (t)v:B$, which gives $\Gamma,\Delta\vdash_D w\share*{}{(t)v}:A$.
\item
If $u=w\distr*{\vv*x}y{s^n\share*{}{(t)v}}$, both
$w\distr*{\vv*x}y{s^n\share*{}y},(t)v\in\SN$
and
$S(w\distr*{\vv*x}y{s^n\share*{}y}),S((t)v)<S(u)$,
so by the induction hypothesis we have $\Gamma,\vv*x:\bigcap_{i\leq m}(B_i\vlim C_i)\vdash_D w:A$ and, for each $i\leq m$, $\Delta\vdash_D s^n:C_i$, and $\Sigma,y:X\vdash_D (t)v:Y$. We then get, for each $i\leq m$, $\Delta,y:X^+\vdash_D s^n\share*{}{(t)v}:C_i$, which gives $\Gamma,\Delta,\Sigma\vdash_D w\distr*{\vv*x}y{s^n\share*{}{(t)v}}:A$.
%the induction hypothesis we have $\Gamma, (x_i:B_i\vlim C_i)_{i\leq n}\vdash_D v:A$ and $\Delta,y:X\vdash_D w:B$ so we have $\Delta,y:X^+\vdash_D w:B$ and $\Gamma,\Delta\vdash_D v\distr xy{t^n\share*{}w}:A$.
\item
If $u$ is not a redex, proceed by induction on the structure of $u$:
\begin{itemize}
\item
$u=\lambda x.t$, $t$ is typeable by the induction hypothesis, and $u$ is typable as in the proof of Proposition~\ref{prop:typable normal form}.
\item
$u=(\dotso(x)t_1\dotso )t_n$, by the induction hypothesis each of $t_1$, $\dots$, $t_n$ and so is $u$ as in the proof of Proposition~\ref{prop:typable normal form}.
\item
$u=v\share xy$, by the induction hypothesis we have $\Gamma,(x_i:B_i)_{i\leq n}\vdash_D v:A$ so $\Gamma,\Delta\vdash_D v\share xy:A$ as in the proof of Proposition~\ref{prop:typable normal form}.
\end{itemize}
\end{itemize}
\end{proof}




